/********************************************************************************
;Important Notice:
;
;1."FlagOffGrid", "Non45 edge" and "Non 90 edge" are default check item
;If you want to waive, please review these errors of layout first.
;
;2.Please pay attention to the text label level.
;If the label is not in the top level layout, please set avParameters(?textLevel ( 0:100 ))
;
/********************************************************************************
;$Author: shirleyc $
;$Revision: 1.2
;$Date: 2009/02/12 07:15:32 $
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;										;
;	0.18um Assura DRC command file for					;
;										;
;	SMIC:	  0.18um Logic 1P6M Salicide 1.8/3.3V Design Rules		;
;	Doc. NO.: TD-LO18-DR-2001		Rev.:4P		         	;
;										;
;	0.18um Mixed Signal 1P6M Salicide 1.8V/3.3V Design Rules		;
;	Doc. NO.: TD-MM18-DR-2001		Rev.:7P 			;
;										;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;										;
;    DISCLAIMER									;
;										;
;   SMIC hereby provides the quality information to you but makes no claims,	;
; promises or guarantees about the accuracy, completeness, or adequacy of the	;
; information herein. The information contained herein is provided on an "AS IS";
; basis without any warranty, and SMIC assumes no obligation to	provide support ;
; of any kind or otherwise maintain the information.				;
;										;
;   SMIC disclaims any representation that the information does not infringe any;
; intellectual property rights or proprietary rights of any third parties. SMIC	;
; makes no other warranty, whether express, implied or statutory as to any	;
; matter whatsoever, including but not limited to the accuracy or sufficiency of;
; any information or the merchantability and fitness for a particular purpose.	;
; Neither SMIC nor any of its representatives shall be liable for any cause of	;
; action incurred to connect to this service.					;
;										;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;										;
;    STATEMENT OF USE AND CONFIDENTIALITY					;
;										;
;   The following/attached material contains confidential and proprietary	;
; information of SMIC. This material is based upon information which SMIC	;
; considers reliable, but SMIC neither represents nor warrants that such	;
; information is accurate or complete, and it must not be relied upon as such.	;
; This information was prepared for informational purposes and is for the use by;
; SMIC's customer only. SMIC reserves the right to make changes in the		;
; information at any time without notice.					;
;   No part of this information may be reproduced, transmitted, transcribed,	;
; stored in a retrieval system, or translated into any human or computer	;
; language, in any form or by any means, electronic, mechanical, magnetic,	;
; optical, chemical, manual, or otherwise, without the prior written consent of ;
; SMIC. Any unauthorized use or disclosure of this material is strictly		;
; prohibited and may be unlawful. By accepting this material, the receiving	;
; party shall be deemed to have acknowledged, accepted, and agreed to be bound	;
; by the foregoing limitations and restrictions. Thank you.			;
;										;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;										;
; Read Me First !!!								;
;										;
; 1> EDA tools environment requirement: Assura 3.1.6 or above.			;
; 2> DG.3a is for the space for DG and mosaa, and it's default to check.        ;
;    DRC is uncheck DG.3b,it is for DG and Pick-AA .If want to check all AA to  ;
;    DG space , customer can open the mark "DG_3b" in the related rsf file or   ;  
;    select the option in the virtuosal.                                        ;
; 3> NW.3 maybe cause false error because of the power text not located on the  ;
;    top level      								;
;										;
; 4> "Poly Resistor" rule are guidelines, user can decide follow or not.	;
;										;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;										;
;    Revision History								;
;										;
;   rev         date         who        what					;
; -------  -------------  -----------  -----------------------------------------;
;  pre20130227             Jane        Enhance HRP.7,GT_Res.2,GT_Res.1          ;
;                                      Delete Layer"M1SLOT"to"M6SLOT"           ;
;                                      merge OPCBA OPCBP OPCBM to OPC           ;
;  1.3      09-Jan-2009    Lasia         Optimize poly resistor defintion       ;
;			   Shirley	 update SN.15,SP.15,HRP.2,HRP.6,HRP.8   ;
;					 LDD.14,GT.7				;
;					 add 2T/3T/SPIR inductor check in MTT.10;
;										;
;  1.2      12-Nov-2008    Shirley       1.remove "shielded" from GT.3,SP.5,SP.11;
;					 2.update Mn.4,Mn.5,Vn.4,SN.2,SP.2,SN.3 ;
;					 SP.3					;
;										;
;  1.1      12-Mar-2008    Shirley       Mixed Signal DR update to 7P		;
;                                        1) update MVN.3,MVN.5,MVN.5a,MVP.3,MVP.5;
;                                        rule description: PO-->gate            ;
;                                        2) update Mn.2: check touch case       ;
;                                        3) add mim18b: bottom metal should be  ;
;                                        under the MIM layer                    ;
;                                        MiM.4:CAP_MIM enclosure Mbot_CAPMIM    ;
;-------------------------------------------------------------------------------;
; Old File Name: SmicDRL4PM6P_asr018_mixlog_sali_p1mtx_1833.drc                 ;
;										;
;  1.6      29-Jan-2008    Shirley       Update MIM.13,MiM.14,GT.12(density)    ;
;					 DNW.6:remove shielded option           ;
;  1.5      03-Jan-2008    Shirley       Update Mn.5,optimize Mixed_Signal part ;
;  1.4      06-Dec-2007    Shirley       update MVN.3,MVP.3,PSUB.9              ;
;  1.3      28-Nov-2007    Shirley       Update DG.3a                           ;
;  1.2      20-Nov-2007    Shirley       Update GT.8,SN.10&11,SP.10&11          ;
;  1.1      10-Aug-2007    Shirley       Update DRC based on Logic DR revised to;
;					 4P:add PI rule;add Latchup.Guidance.3  ;
;					 modify SN.15a&SP.15.a(all_polyr -> all_polyr_nohr3t);
;-------------------------------------------------------------------------------;
;  Old File Name : SmicDRL3PM6P_asr018_mixlog_sali_p1mtx_1833.drc               ;
;                                                                               ;
;  1.1      30-May-2007    Shirley       Logic DR update to 3P,change file name ;
;                                        Modify SN.11,SP.11;Mn.4,Mn.5,Vn.4;CT.5 ;
;					 Move SN.12&SP.12 to SN.18&SP.18        ;
;					 Add "flagOffGrid" option               ;
;					 Separate logic part from mixlog file   ;
;-------------------------------------------------------------------------------;
;  Old File Name : SmicDRL2TM6P_asr018_mixlog_p2mx_mt.drc                       ;
;										;
;  1.1      21-Apr-2006    Shirley       Update based on Mixed Signal DR( 6P)   ;
;                                        No rule change			        ;
;-------------------------------------------------------------------------------;
;  1.9      21-Apr-2006    Shirley      Modify Res_** to RES**                  ;
;  1.8      30-DEC-2005    Shirley      Add option for "DG_3b"                  ;
;  1.7      14-AUG-2005    Yang         1)Add the SN18&SP18 based on designrule2T   
;                                       2)Update the M1.3                       ;
;  1.6      11-AUG-2005    Shirley      Optimize runset:Rule GT.8               ;
;  1.5      15-JUL-2005    Yang  Liu    1)Update SAB.9,SN.12                    ;
;                                       2)Update the checking of line-end       ;
;  1.4      05-MAR-2005    Yang  Liu    Update DG.3(MOSS AA checking by default);
;                                       HRP.8,GT.9                              ;
;  1.3      31-DEC-2004    Yang  Liu    Modify dummy layers name:ResP1,ResAA    ;
;  1.2      27-SEP-2004    Yang  Liu    Add density check switch                ;
;  1.1      08-SEP-2004    Yang  Liu    Update to Mixed 4P Version:Del. MIMDMY  ;
;                                       Del. M1~M6 DUMMY Defination             ;
;  1.1      04-AUG-2004    Yang  Liu    Update to Mixed 3P :Modify MiM.18       ;
;  1.6      09-JNU-2004    Yang  Liu    Fix MiM.10 pseudo error                 ;
;  1.5      24-MAY-2004    Yang  Liu    Add Switch :top_m2,top_m3;Modify NR.8   ;       
;  1.4      12-MAY-2004    Yang  Liu    Add offGrid check  switch               ;
;  1.3      11-MAY-2004    Yang  Liu    Modify NR.4:0.3==>0.22                  ;
;  1.2      21-APR-2004    Yang  Liu    Modify lineEnd_enc_via                  ;
;  1.1      25-MAR-2004    Yang  Liu    Modify INDMY MIMDMY HRPDMY layers No.   ;
;                                       Update to 2T:Add HRP.10 NAN-->NN        ;  
;                                       Add NLL.14,NLH.14,PLL.14,PLH.14         ;
;                                       Modify GT.10,GT.11 GT.12 GT.14          ; 
;  1.0.0    08-AUG-2003    RunZe Li     Original version			;
;										;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

Assura DRC Rules File


Title: Assura DRC rules for SMIC 0.18um Logic/Mixed Signal

*---------------------------------------------------------------------*
* Cadence Design Systems shall not be liable for the accuracy of      *
* this design rule file or it's ability to capture errors.            *
* The user is responsible for thoroughly testing and implementing     *
* it's features.                                                      *
*---------------------------------------------------------------------*

**********************************************************************/

; --------------   BEGIN DRC RULES   -----------


drcExtractRules(

  fileVer  = "1.0"
  fileDate = "Jun 10, 2003"
  libType  = "SMIC"



; ****************************************************
;          1. Input Layers
; ****************************************************

layerDefs( "df2"
;  ----  logic layer  ----
;  L0i    	= layer( "L0" type("drawing") )
   AA0i     	= layer( "AA" "NPAA" "PPAA" "DUMAA" type("drawing") )
   NWi      	= layer( "NW" type("drawing") )
   DGi      	= layer( "DG" type("drawing") )
;  PWi      	= layer( "PW" type("drawing") )
   GTi      	= layer( "GT" type("drawing") )
   DUMGTi       = layer( "DUMGT" type("drawing") )
   GT_pintext   = pinText( "GT" )
   NLLi     	= layer( "NLL" type("drawing") )
   NLHi     	= layer( "NLH" type("drawing") )
   PLHi     	= layer( "PLH" type("drawing") )
   PLLi     	= layer( "PLL" type("drawing") )
   SNi      	= layer( "SN" type("drawing") )
   SPi      	= layer( "SP" type("drawing") )
   SABi     	= layer( "SAB" type("drawing") )
   ESD1i        = layer( "ESD1" type("drawing") )
   ESD2i        = layer( "ESD2" type("drawing") )
   CTi      	= layer( "CT" type("drawing") )
   M1i      	= layer( "M1" type("drawing") )
   M1_pintext  	= pinText( "M1" )
   M1DUMi       = layer( "M1DUM" type("drawing") )
   V1i      	= layer( "V1" type("drawing") )
   M2i      	= layer( "M2" type("drawing") )
   M2_pintext  	= pinText( "M2" )
   M2DUMi       = layer( "M2DUM" type("drawing") )
   V2i      	= layer( "V2" type("drawing") )
   M3i      	= layer( "M3" type("drawing") )
   M3_pintext  	= pinText( "M3" )
   M3DUMi       = layer( "M3DUM" type("drawing") )
   V3i      	= layer( "V3" type("drawing") )
   M4i      	= layer( "M4" type("drawing") )
   M4_pintext  	= pinText( "M4" )
   M4DUMi       = layer( "M4DUM" type("drawing") )
   V4i      	= layer( "V4" type("drawing") )
   M5i      	= layer( "M5" type("drawing") )
   M5_pintext  	= pinText( "M5" )
   M5DUMi       = layer( "M5DUM" type("drawing") )
   V5i      	= layer( "V5" type("drawing") )
   M6i      	= layer( "M6" type("drawing") )
   M6_pintext  	= pinText( "M6" )
   M6DUMi       = layer( "M6DUM" type("drawing") )
   PI           = layer( "PI" type("drawing") )
   FUSE         = layer( "FUSE" type("drawing") )
   PAi          = layer( "PA" type("drawing") )
   BORDER       = layer( "BORDER" type("drawing") )

   RESP3Ti	= layer( "RESP3T" type("drawing") )
   RESNWi     	= layer( "RESNW" type("drawing") )
   RESP1i     	= layer( "RESP1" type("drawing") )
   RESAAi     	= layer( "RESAA" type("drawing") )
   OPCBA     	= layer( "OPC" type("opcba") )
   OPCBP     	= layer( "OPC" type("opcbp") )
   OPCBM     	= layer( "OPC" type("opcbm") )

   CAPBP        = layer( "CAPBP" type("drawing") )
   MIMDMY       = layer( "MIMDMY" type("drawing") )

   HTNWLi      	= layer( "HTNWL" type("drawing") )
   EXCLU      	= layer( "EXCLU" type("drawing") )

   M1TXT      	= text( "M1TXT" ) 	
   M2TXT      	= text( "M2TXT" ) 	
   M3TXT      	= text( "M3TXT" ) 	
   M4TXT      	= text( "M4TXT" ) 	
   M5TXT      	= text( "M5TXT" ) 	
   M6TXT      	= text( "M6TXT" ) 	

   text    	= layer( "text" type("drawing") )

   M1TEXT       = text( "M1" type("drawing") )
   M2TEXT       = text( "M2" type("drawing") )
   M3TEXT       = text( "M3" type("drawing") )
   M4TEXT       = text( "M4" type("drawing") )
   M5TEXT       = text( "M5" type("drawing") )
   M6TEXT       = text( "M6" type("drawing") )

   GT_text      = textToPin( "GT" )
   M1_text      = textToPin( "M1" )
   M2_text      = textToPin( "M2" )
   M3_text      = textToPin( "M3" )
   M4_text      = textToPin( "M4" )
   M5_text      = textToPin( "M5" )
   M6_text      = textToPin( "M6" )
  
/*
   GT_pText     = pinText( "GT" )
   M1_pText     = pinText( "M1" )
   M2_pText     = pinText( "M2" )
   M3_pText     = pinText( "M3" )
   M4_pText     = pinText( "M4" )
   M5_pText     = pinText( "M5" )
   M6_pText     = pinText( "M6" )
*/

   GT_pLay      = pinLayer( "GT" )
   M1_pLay      = pinLayer( "M1" )
   M2_pLay      = pinLayer( "M2" )
   M3_pLay      = pinLayer( "M3" )
   M4_pLay      = pinLayer( "M4" )
   M5_pLay      = pinLayer( "M5" )
   M6_pLay      = pinLayer( "M6" )

; ---- mixed signal layer ----

   DNWi      	= layer( "DNW" type("drawing") )
   PSUBi      	= layer( "PSUB" type("drawing") )
   MVPi      	= layer( "MVP" type("drawing") )
   MVNi      	= layer( "MVN" type("drawing") )
   HRPi     	= layer( "HRP" type("drawing") )
   MIMi    	= layer( "MIM" type("drawing") )

   HRPDMYi     	= layer( "HRPDMY" type("drawing") )
   INDMYi      	= layer( "INDMY" type("drawing") )
   IND_TEXT     = text( "INDMY" type("drawing") idOnly)
); layerDefs complete

layerDefs( "gds2"
;  L0i    	= layer(  0  )
   AA0i     	= layer(  10 12 13 )
   NWi      	= layer(  14 )
   DGi      	= layer(  29 )
  ;PWi      	= layer(  20 )
   GTi      	= layer(  30 )
   DUMGTi       = layer(  30 type(1) )
   NLLi     	= layer(  35 )
   NLHi     	= layer(  36 )
   PLHi     	= layer(  37 )
   PLLi     	= layer(  38 )
   SNi      	= layer(  40 )
   ESD1i        = layer(  41 )
   ESD2i        = layer(  42 )
   SPi      	= layer(  43 )
   SABi     	= layer(  48 )
   CTi      	= layer(  50 )
   M1i      	= layer(  61 )
   V1i      	= layer(  70 )
   M2i      	= layer(  62 )
   V2i      	= layer(  71 )
   M3i      	= layer(  63 )
   V3i      	= layer(  72 )
   M4i      	= layer(  64 )
   V4i      	= layer(  73 )
   M5i      	= layer(  65 )
   V5i      	= layer(  74 )
   M6i      	= layer(  66 )
   M1DUMi       = layer(  61 type(1) )
   M2DUMi       = layer(  62 type(1) )
   M3DUMi       = layer(  63 type(1) )
   M4DUMi       = layer(  64 type(1) )
   M5DUMi       = layer(  65 type(1) )
   M6DUMi       = layer(  66 type(1) )
   PAi          = layer(  80 )
   FUSE         = layer(  81 )
   PI           = layer(  82 )
   text    	= layer(  87 )

   RESNWi     	= layer(  95 )
   RESP1i     	= layer(  96 )
   RESP3Ti      = layer(  96 type(1) )
   RESAAi     	= layer(  97 )
   OPCBA     	= layer( 100 )
   OPCBP     	= layer( 101 )
   OPCBM     	= layer( 102 )
   BORDER       = layer( 127 )

   HTNWLi      	= layer( 131 )
   EXCLU      	= layer( 132 )
   CAPBP        = layer( 137 )
   M1TXT	= text( 141 )
   M2TXT 	= text( 142 )
   M3TXT	= text( 143 )
   M4TXT    	= text( 144 )
   M5TXT	= text( 145 )
   M6TXT	= text( 146 )

   M1TEXT        = text( 61 )
   M2TEXT        = text( 62 )
   M3TEXT        = text( 63 )
   M4TEXT        = text( 64 )
   M5TEXT        = text( 65 )
   M6TEXT        = text( 66 )

   GT_text      = textToPin( 30 )
   M1_text      = textToPin( 61 )
   M2_text      = textToPin( 62 )
   M3_text      = textToPin( 63 )
   M4_text      = textToPin( 64 )
   M5_text      = textToPin( 65 )
   M6_text      = textToPin( 66 )


   M1TXT        = textToPin( 141 )
   M2TXT        = textToPin( 142 )
   M3TXT        = textToPin( 143 )
   M4TXT        = textToPin( 144 )
   M5TXT        = textToPin( 145 )
   M6TXT        = textToPin( 146 )

   M1TEXT       = textToPin( 61 )
   M2TEXT       = textToPin( 62 )
   M3TEXT       = textToPin( 63 )
   M4TEXT       = textToPin( 64 )
   M5TEXT       = textToPin( 65 )
   M6TEXT       = textToPin( 66 )

   GT_pLay      = pinLayer( 30 )
   M1_pLay      = pinLayer( 61 )
   M2_pLay      = pinLayer( 62 )
   M3_pLay      = pinLayer( 63 )
   M4_pLay      = pinLayer( 64 )
   M5_pLay      = pinLayer( 65 )
   M6_pLay      = pinLayer( 66 )

; ---- mixed signal layer ----

   DNWi      	= layer( 19 )
   PSUBi    	= layer( 85 )
   MVPi      	= layer( 44 )
   MVNi      	= layer( 45 )
   HRPi     	= layer( 39 )
   MIMi    	= layer( 58 )

   HRPDMYi     	= layer( 210 )
   INDMYi      	= layer( 212 )
   IND_TEXT     = text( 212 type(0) idOnly)
   MIMDMY       = layer( 211 )
)
if( !avSwitch( "NoflagOffGrid" ) then
offGrid(AA0i 0.005 "off grid polygon on layer AA")
offGrid(NWi 0.005 "off grid polygon on layer NW")
offGrid(DGi 0.005 "off grid polygon on layer DG")
offGrid(GTi 0.005 "off grid polygon on layer GT")
offGrid(NLLi 0.005 "off grid polygon on layer NLL")
offGrid(NLHi 0.005 "off grid polygon on layer NLH")
offGrid(PLLi 0.005 "off grid polygon on layer PLL")
offGrid(PLHi 0.005 "off grid polygon on layer PLH")
offGrid(SNi 0.005 "off grid polygon on layer SN")
offGrid(SPi 0.005 "off grid polygon on layer SP")
offGrid(ESD1i 0.005 "off grid polygon on layer ESD1")
offGrid(ESD2i 0.005 "off grid polygon on layer ESD2")
offGrid(SABi 0.005 "off grid polygon on layer SAB")
offGrid(CTi 0.005 "off grid polygon on layer CT")
offGrid(M1i 0.005 "off grid polygon on layer M1")
offGrid(V1i 0.005 "off grid polygon on layer V1")
offGrid(M2i 0.005 "off grid polygon on layer M2")
offGrid(V2i 0.005 "off grid polygon on layer V2")
offGrid(M3i 0.005 "off grid polygon on layer M3")
offGrid(V3i 0.005 "off grid polygon on layer V3")
offGrid(M4i 0.005 "off grid polygon on layer M4")
offGrid(V4i 0.005 "off grid polygon on layer V4")
offGrid(M5i 0.005 "off grid polygon on layer M5")
offGrid(V5i 0.005 "off grid polygon on layer V5")
offGrid(M6i 0.005 "off grid polygon on layer M6")
offGrid(M1DUMi 0.005 "off grid polygon on layer M1DUM")
offGrid(M2DUMi 0.005 "off grid polygon on layer M2DUM")
offGrid(M3DUMi 0.005 "off grid polygon on layer M3DUM")
offGrid(M4DUMi 0.005 "off grid polygon on layer M4DUM")
offGrid(M5DUMi 0.005 "off grid polygon on layer M5DUM")
offGrid(M6DUMi 0.005 "off grid polygon on layer M6DUM")
offGrid(RESNWi 0.005 "off grid polygon on layer RESNW")
offGrid(RESP1i 0.005 "off grid polygon on layer RESP1")
offGrid(RESAAi 0.005 "off grid polygon on layer RESAA")
offGrid(RESP3Ti 0.005 "off grid polygon on layer RESP3T")
offGrid(OPCBA 0.005 "off grid polygon on layer OPCBA")
offGrid(OPCBP 0.005 "off grid polygon on layer OPCBP")
offGrid(OPCBM 0.005 "off grid polygon on layer OPCBM")
offGrid(PAi   0.005 "off grid polygon on layer PA")
offGrid(PI    0.005 "off grid polygon on layer PI")
offGrid(FUSE  0.005 "off grid polygon on layer FUSE")
offGrid(EXCLU 0.005 "off grid polygon on layer EXCLU")
offGrid(HTNWLi 0.005 "off grid polygon on layer HTNWL")
offGrid(M1TXT 0.005 "off grid polygon on layer M1TXT")
offGrid(M2TXT 0.005 "off grid polygon on layer M2TXT")
offGrid(M3TXT 0.005 "off grid polygon on layer M3TXT")
offGrid(M4TXT 0.005 "off grid polygon on layer M4TXT")
offGrid(M5TXT 0.005 "off grid polygon on layer M5TXT")
offGrid(M6TXT 0.005 "off grid polygon on layer M6TXT")
offGrid(DNWi 0.005 "off grid polygon on layer DNW")
offGrid(PSUBi 0.005 "off grid polygon on layer PSUB")
offGrid(MVNi 0.005 "off grid polygon on layer MVN")
offGrid(MVPi 0.005 "off grid polygon on layer MVP")
offGrid(HRPi 0.005 "off grid polygon on layer HRP")
offGrid(MIMi 0.005 "off grid polygon on layer MIM")
offGrid(HRPDMYi 0.005 "off grid polygon on layer HRPDMY")
offGrid(INDMYi  0.005 "off grid polygon on layer INDMY")
offGrid(BORDER  0.005 "off grid polygon on layer BORDER")

)



;**********************************************
;   2.   Layer Derived  
;**********************************************

; ----  logic exclude  ----

   EXCLU_aa	= geomOr( OPCBA EXCLU )
   EXCLU_gt	= geomOr( OPCBP EXCLU )
   EXCLU_ap	= geomOr( EXCLU_aa EXCLU_gt )
   EXCLU_m1	= geomOr( OPCBM EXCLU )

;  L0     	= geomAndNot( L0i EXCLU )
   AA           = geomAndNot( AA0i EXCLU_aa )
   NW       	= geomAndNot( NWi EXCLU )
   DG       	= geomAndNot( DGi EXCLU )
  ;PW           = geomAndNot( PWi EXCLU )
   GT_e         = geomOr( GTi DUMGTi )
   GT       	= geomAndNot( GT_e EXCLU_gt )
   NLL      	= geomAndNot( NLLi EXCLU )
   NLH      	= geomAndNot( NLHi EXCLU )
   PLH      	= geomAndNot( PLHi EXCLU )
   PLL      	= geomAndNot( PLLi EXCLU )
   SN       	= geomAndNot( SNi EXCLU )
   SP       	= geomAndNot( SPi EXCLU )
   ESD1         = geomAndNot( ESD1i EXCLU )
   ESD2         = geomAndNot( ESD2i EXCLU )
   SAB      	= geomAndNot( SABi EXCLU )
   CT       	= geomAndNot( CTi EXCLU )
   CT_excl_opap	= geomAndNot( CTi EXCLU_ap )
   CT_excl_opm1	= geomAndNot( CTi EXCLU_m1 )
   M1_e         = geomOr( M1i M1DUMi )
   M1O          = geomAndNot( M1_e EXCLU )
   M1           = geomAndNot( M1O OPCBM )
   V1O      	= geomAndNot( V1i EXCLU )
   V1           = geomAndNot( V1O OPCBM )
   M2_e         = geomOr( M2i M2DUMi )
   M2       	= geomAndNot( M2_e EXCLU )
   V2       	= geomAndNot( V2i EXCLU )
   M3_e         = geomOr( M3i M3DUMi )
   M3       	= geomAndNot( M3_e EXCLU )
   V3       	= geomAndNot( V3i EXCLU )
   M4_e         = geomOr( M4i M4DUMi )
   M4           = geomAndNot( M4_e EXCLU )
   V4       	= geomAndNot( V4i EXCLU )
   M5_e         = geomOr( M5i M5DUMi )
   M5           = geomAndNot( M5_e EXCLU )
   V5       	= geomAndNot( V5i EXCLU )
   M6_e         = geomOr( M6i M6DUMi )
   M6           = geomAndNot( M6_e EXCLU )

   RESNW      	= geomAndNot( RESNWi EXCLU )
   RESP1      	= geomAndNot( RESP1i EXCLU )
   RESAA      	= geomAndNot( RESAAi EXCLU )
   RESP3T	= geomAndNot( RESP3Ti EXCLU )

   HTNWL       	= geomAndNot( HTNWLi EXCLU )
   PA           = geomAndNot( PAi EXCLU )

; ----  mixed signal layer excluded  ----

   DNW       	= geomAndNot( DNWi EXCLU )
   PSUB     	= geomAndNot( PSUBi EXCLU )
   MVP       	= geomAndNot( MVPi EXCLU )
   MVN       	= geomAndNot( MVNi EXCLU )
   HRP      	= geomAndNot( HRPi EXCLU )
   MIM     	= geomAndNot( MIMi EXCLU )

   HRPDMY      	= geomAndNot( HRPDMYi EXCLU )
   INDMY       	= geomAndNot( INDMYi EXCLU )

   bulk         = geomBkgnd(0)
   PWa          = geomAndNot( geomAndNot( bulk NW ) PSUB )
  ;PWc          = geomOr( PW PWa )


; -----   NW  derived  -----

  nwOutRes     	= geomOutside( NW RESNW )
  nwr1  	= geomButtOrOver( NW   RESNW )
  nwr2  	= geomButtOrOver( nwr1 SAB )
  nwr3          = geomAnd( nwr2 RESNW )
  nwr4          = geomButtOrOver( geomInside( NW AA ) RESNW )

; -----   AA  Derived  -----

  bulk     = geomBkgnd(0)		;everything
  aawr	   = geomButtOrOver( AA nwr2 )
  aa1	   = geomAndNot( AA aawr )
  naa      = geomAnd( aa1 SN )	;N+ OD
  paa      = geomAnd( aa1 SP )	;P+ OD

  ntie     = geomAnd(naa NW)		;N+ NW tie
  ptie     = geomAndNot(paa NW)  	;P+ Psub tie
  pact	   = geomAnd( paa NW )
  nact	   = geomAndNot( naa NW )
  act      = geomOr( paa naa )


; -----  Poly Resistor ------

  gtresdum      = geomOr( RESP1 RESP3T )

  gt_res_nohrp  = geomButtOrOver( geomOutside( GT HRP ) RESP1 )
  gt_res_hrp    = geomButtOrOver( GT HRP )
  polyRes       = geomOr( gt_res_nohrp gt_res_hrp )
  n_polyRes     = geomButtOrOver( polyRes SN )
  p_polyRes     = geomButtOrOver( polyRes SP )
  hr_gt          = geomAnd( gt_res_hrp HRPDMY )

  polyr_hrp     = geomAnd( GT HRP )
  hrpdums       = geomAnd( HRPDMY SAB )
  all_polyr_hrp = geomButtOrOver( polyr_hrp hrpdums )  ;all GT in HRP resistor
  all_hrpr      = geomAnd( polyr_hrp HRPDMY )          ;HRP resistor with HRPDMY
  all_hrpr_nosp = geomAndNot( polyr_hrp all_hrpr )     ;HRP resistor without SP 

  all_polyr_nosp = geomAndNot( polyRes all_hrpr )      ;SN.15
  
; -----   S/D derived  -----

  poly	   = geomAndNot( GT polyRes )
  gate     = geomAnd( poly AA)		;Gate

  psd      = geomAndNot( pact gate )	;P+ s/d
  nsd      = geomAndNot( nact gate )	;N+ s/d
  allsd    = geomCat( nsd psd )         ;ALL s/d

  pmos = geomEnclose( pact gate )
  nmos = geomEnclose( nact gate )


; -----   GT  Derived  -----

  pgate      = geomAndNot( gate  SN )
  ngate      = geomAndNot( gate  SP )

  pgateEdgeL = drc( AA pgate  enc == 0 edgeb opposite )
  ngateEdgeL = drc( AA ngate  enc == 0 edgeb opposite )
  ngateEdgeW = drc( ngate nsd sep == 0 edgea opposite )
  pgateEdgeW = drc( pgate psd sep == 0 edgea opposite )
 
  ngate35    = geomSize( ngate 0.35 )
  ngt35	     = geomAnd( ngate35 poly )
  ngate35ew  = geomStretch( ngateEdgeW 0.35 )
  ngt35EdgeW = geomAnd( ngate35ew ngt35 )

  pgate35    = geomSize( pgate 0.35 )
  pgt35      = geomAnd( pgate35 poly )
  pgate35ew  = geomStretch( pgateEdgeW 0.35 )
  pgt35EdgeW = geomAnd( pgate35ew pgt35 )

  ngate32    = geomSize( ngate 0.32 )
  ngate32el  = geomStretch( ngateEdgeL 0.32 )
  ngt32EdgeL = geomAnd( ngate32el ngate32 )



; -----  Dual GATE derived  ----- 
 
  lvgate    = geomAndNot( gate DG )
  hvgt      = geomAndNot( gate lvgate )
  hvgtWEdg  = drc( hvgt GT  enc == 0 edgea opposite  )


; -----  Grid Check -----

NW_g    = geomGetNon45( NW )
errorLayer( NW_g "Non-45 NW edge" )
AA_g    = geomGetNon45( AA )
errorLayer( AA_g "Non-45 AA edge" )
DNW_g   = geomGetNon45( DNW )
errorLayer( DNW_g "Non-45 DNW edge" )
GT_g    = geomGetNon45( GT )
errorLayer( GT_g "Non-45 GT edge" )
NLL_g   = geomGetNon45( NLL )
errorLayer( NLL_g "Non-45 NLL edge" )
PLL_g   = geomGetNon45( PLL )
errorLayer( PLL_g "Non-45 PLL edge" )
HRP_g   = geomGetNon45( HRP )
errorLayer( HRP_g "Non-45 HRP edge" )
SN_g    = geomGetNon45( SN )
errorLayer( SN_g "Non-45 SN edge" )
SP_g    = geomGetNon45( SP )
errorLayer( SP_g "Non-45 SP edge" )
ESD1_g  = geomGetNon45( ESD1 )
errorLayer( ESD1_g "Non-45 ESD1 edge" )
ESD2_g  = geomGetNon45( ESD2 )
errorLayer( ESD2_g "Non-45 ESD2 edge" )
SAB_g   = geomGetNon45( SAB )
errorLayer( SAB_g "Non-45 SAB edge" )
PSUB_g   = geomGetNon45( PSUB )
errorLayer( PSUB_g "Non-45 PSUB edge" )
M1_g    = geomGetNon45( M1 )
errorLayer( M1_g "Non-45 M1 edge" )
M2_g    = geomGetNon45( M2 )
errorLayer( M2_g "Non-45 M2 edge" )
M3_g    = geomGetNon45( M3 )
errorLayer( M3_g "Non-45 M3 edge" )
M4_g    = geomGetNon45( M4 )
errorLayer( M4_g "Non-45 M4 edge" )
M5_g    = geomGetNon45( M5 )
errorLayer( M5_g "Non-45 M5 edge" )
M6_g    = geomGetNon45( M6 )
errorLayer( M6_g "Non-45 M6 edge" )
CT_g   = geomGetNon90( CT )
errorLayer( CT_g "Non-90 CT edge" )
V1_g   = geomGetNon90( V1 )
errorLayer( V1_g "Non-90 V1 edge" )
V2_g   = geomGetNon90( V2 )
errorLayer( V2_g "Non-90 V2 edge" )
V3_g   = geomGetNon90( V3 )
errorLayer( V3_g "Non-90 V3 edge" )
V4_g   = geomGetNon90( V4 )
errorLayer( V4_g "Non-90 V4 edge" )
V5_g   = geomGetNon90( V5 )
errorLayer( V5_g "Non-90 V5 edge" )




;******************************************
;   3.  Define Procedure  
;******************************************

; -----  3.1 density procedure  -----

procedure( density( den_layer den_val )
 if( avSwitch( "noDensityChecking") then
  coverage_error = geomEmpty()
 else 
  den_coverage   = drc( den_layer coverage < den_val )
  coverage_error = geomGetCoverage( den_coverage keep < den_val )
   )
         ); end procedure density

; may have problem

; -----  3.2 lineEnd_enc_via procedure  -----

procedure( lineEnd_enc_via( metal via via_width min_encl_val eol_value )
  fast_venc = drc( metal via venc( enc1<0.01 enc2<0.06 enc3<0.01 enc4<0.06 ) )
  venc_err  = geomSize( fast_venc .01 )
  fast_vias = geomButtOrOver( via venc_err )
  fvia_area = geomSize( fast_vias ( eol_value + .1 ))
  met_over_via = geomAnd( metal fvia_area )
  lineEnd = geomLineEnd( met_over_via ( via_width + ( ( 3* eol_value ) - .001 ))
				      ( via_width + ( 2* min_encl_val ))    
					legs( eol_value ) )

  lineEndError = drc( lineEnd fast_vias enc < eol_value edgeb )
) ; end procedure lineEnd_enc_via 

; -----  3.3 fat_space  -----

  procedure( fat_space( fat_layer fat_value space_value )
    wide            = geomWidth( fat_layer keep > fat_value )    
    fat_dn          = geomSize( wide minus(((fat_value / 2) - .005 )) ) 
    fat             = geomButtOrOver( wide fat_dn ) 
    fat_grown_1um   = geomSizeAnd( fat fat_layer 0.20 1.00 )
    new             = geomAndNot( fat_layer fat_grown_1um )
    fat_space_error = drc( fat_grown_1um new 0 < sep < space_value opposite shielded )
  ) ; end procedure fat_space

    procedure( fat_space2( fat_layer fat_value space_value )
    wide            = geomWidth( fat_layer keep > fat_value )
    fat_dn          = geomSize( wide minus(((fat_value / 2) - .005 )) )
    fat             = geomButtOrOver( wide fat_dn )
    fat_grown_1um   = geomSizeAnd( fat fat_layer 0.20 1.00 )
    fat_space_error2 = drc( fat_grown_1um 0 < sep < space_value opposite shielded )
  ) ; end procedure fat_space2

  procedure( no_bend_and_orth( inlayer intolayer )
    in_into       = geomButtOrOver( inlayer intolayer )
    in_into_angle = geomGetCorner( in_into angleAll )
    bend_in    = geomStretchCorner( in_into_angle 0.05 angleAll concave ) 
    bend_error    = geomAnd( bend_in intolayer ) 
    outside_orth  = geomAndNot( in_into intolayer )
    orth_error    = geomGetAcuteAngle( outside_orth )
    bend_orth     = geomOr( bend_error orth_error )
  ) ; end procedure no_poly_bend 


;********************************************
;   4.  Define Connectivity
;********************************************

dcont	= geomAndNot( CT GTi )
pcont	= geomAndNot( CT dcont )

ndcont	= geomAndNot( dcont SP )
pdcont	= geomAndNot( dcont SN )

ptie_2  = geomSize( ptie 0.05 edges )
ptie_3  = geomAnd( ptie_2 nsd )
bptie   = geomSize( ptie_3 0.05 )

ntie_2  = geomSize( ntie 0.05 edges )
ntie_3  = geomAnd( ntie_2 psd )
bntie   = geomSize( ntie_3 0.05 )


if( avSwitch( "top_m2" ) && !avSwitch( "top_m3" ) && !avSwitch( "top_m4" ) && !avSwitch( "top_m5" )  then

    geomConnect(
     via( ndcont M1 nsd ntie )
     via( pdcont M1 psd ptie )
     via( pcont  poly  M1 )

     via( V1  M2  M1  )

     via( bptie nsd ptie )
     via( bntie psd ntie )

;    via( ntie  M1  nwOutRes )

     label( GT_text poly )
     label( M1_text M1 )
     label( M2_text M2 )

     label( M1TXT M1 )
     label( M2TXT M2 )

     label( M1TEXT M1 )
     label( M2TEXT M2 )

     )
);end if top_m2

if( !avSwitch( "top_m2" ) && avSwitch( "top_m3" ) && !avSwitch( "top_m4" ) && !avSwitch( "top_m5" )  then
   
    geomConnect(
     via( ndcont M1 nsd ntie )
     via( pdcont M1 psd ptie )
     via( pcont  poly  M1 )

     via( V2  M3  M2  )
     via( V1  M2  M1  )

     via( bptie nsd ptie )
     via( bntie psd ntie )

;    via( ntie  M1  nwOutRes )

     label( GT_text poly )
     label( M1_text M1 )
     label( M2_text M2 )
     label( M3_text M3 )

     label( M1TXT M1 )
     label( M2TXT M2 )
     label( M3TXT M3 )


     label( M1TEXT M1 )
     label( M2TEXT M2 )
     label( M3TEXT M3 )

     )
);end if top_m3

if( !avSwitch( "top_m2" ) && !avSwitch( "top_m3" ) && avSwitch( "top_m4" ) && !avSwitch( "top_m5" ) then

    geomConnect(

       via( ndcont M1 nsd ntie )
       via( pdcont M1 psd ptie )
       via( pcont  poly   M1 )

       via( V3  M4  M3 )
       via( V2  M3  M2 )
       via( V1  M2  M1 )

       via( bptie nsd ptie )
       via( bntie psd ntie )

; via( ntie  M1  nwOutRes )

       label( GT_text  poly )
       label( M1_text  M1 )
       label( M2_text  M2 )
       label( M3_text  M3 )
       label( M4_text  M4 )

       label( M1TXT    M1 )
       label( M2TXT    M2 )
       label( M3TXT    M3 )
       label( M4TXT    M4 )

       label( M1TEXT M1 )
       label( M2TEXT M2 )
       label( M3TEXT M3 )
       label( M4TEXT M4 )

        )
); end if top_m4

if( !avSwitch( "top_m2" ) && !avSwitch( "top_m3" ) && !avSwitch( "top_m4" ) && avSwitch( "top_m5" ) then

    geomConnect(

       via( ndcont M1 nsd ntie )
       via( pdcont M1 psd ptie )
       via( pcont  poly   M1 )

       via( V4  M5  M4 )
       via( V3  M4  M3 )
       via( V2  M3  M2 )
       via( V1  M2  M1 )

       via( bptie nsd ptie )
       via( bntie psd ntie )

; via( ntie  M1  nwOutRes )

       label( GT_text  poly )
       label( M1_text  M1 )
       label( M2_text  M2 )
       label( M3_text  M3 )
       label( M4_text  M4 )
       label( M5_text  M5 )

       label( M1TXT    M1 )
       label( M2TXT    M2 )
       label( M3TXT    M3 )
       label( M4TXT    M4 )
       label( M5TXT    M5 )

       label( M1TEXT   M1 )
       label( M2TEXT   M2 )
       label( M3TEXT   M3 )
       label( M4TEXT   M4 )
       label( M5TEXT   M5 )

        )
); end if top_m5


if( !avSwitch( "top_m2" ) && !avSwitch( "top_m3" ) && !avSwitch( "top_m4" ) && !avSwitch( "top_m5" )  then
      geomConnect(

      via( ndcont M1 nsd ntie )
      via( pdcont M1 psd ptie )
      via( pcont  poly  M1 )

      via( V5  M6  M5  )
      via( V4  M5  M4  )
      via( V3  M4  M3  )
      via( V2  M3  M2  )
      via( V1  M2  M1  )

      via( bptie nsd ptie )
      via( bntie psd ntie )

; via( ntie  M1  nwOutRes )

     label( GT_text poly )
     label( M1_text M1 )
     label( M2_text M2 )
     label( M3_text M3 )
     label( M4_text M4 )
     label( M5_text M5 )
     label( M6_text M6 )


     label( M1TXT M1 )
     label( M2TXT M2 )
     label( M3TXT M3 )
     label( M4TXT M4 )
     label( M5TXT M5 )
     label( M6TXT M6 )

     label( M1TEXT M1 )
     label( M2TEXT M2 )
     label( M3TEXT M3 )
     label( M4TEXT M4 )
     label( M5TEXT M5 )
     label( M6TEXT M6 )

    )
); end if top_m6
 
geomStamp( nwOutRes ntie )

;*********************************************
;      5.  Logic Design Check 
;*********************************************

;-------------------------------------
; -----  5.1  NW  -----
;-------------------------------------

  clwl1		= geomGetNet( nwOutRes "*VDD*" ) 
  clwl2		= geomGetNet( nwOutRes "*VCC*" ) 
  coldWell	= geomCat( clwl1 clwl2 )
  
  htwl1		= geomAndNot( NW coldWell )
  htwl2		= geomOverlap( NW HTNWL )   
  hw1    	= geomOr( htwl1 htwl2 )
  hotWell	= geomOr( hw1 nwr1 )

;nw01	  =  drc( coldWell width < 0.86 withCornerTouch )

nw01      =  drc( NW width < 0.86 withCornerTouch )
errorLayer( nw01 "NW.1 Min. NW width 0.86um" )


nw02a	  =  drc( NW  0 < sepNotch < 0.6 )
errorLayer( nw02a "NW.2a Min. NW space to same potential nw 0.6um" )

; redefine  geomConnect for cold well connectivity

geomStamp( coldWell ntie )
geomStamp( hotWell ntie )

nw02b01  =  drc( coldWell hotWell 0 < sep < 1.40)
nw02b02  =  drc( coldWell 0 < sep < 1.40 diffNet)
nw02b03  =  drc( hotWell  0 < sep < 1.40 diffNet)
nw02b	  =  geomCat( nw02b01 nw02b02 nw02b03 )
errorLayer( nw02b  "NW.2b NW space to different potential nw 1.4um" )

/*
nw03     = drc( hotWell width < 2.1 )
errorLayer( nw03 "NW.3:Min.dimension of NW not connected to the most positive power supply 2.1um ")
*/

geomStamp( NW ntie )
TEMP0000 = geomAndNot( NW geomGetNet( NW "*VDD*" "*VSS*" ) )
TEMP0001 = drc( TEMP0000 width < 2.1 withCornerTouch )
vdd_m1a  = geomGetNet( M1   "*VDD*" )
vdd_m1b  = geomGetNet( M1   "*VSS*" )
vdd_m1c  = geomGetTexted( M1 M1TXT "*VDD*" )
vdd_m1d  = geomGetTexted( M1 M1TXT "*VSS*" )
TEMP0006 =  geomOr( vdd_m1a geomOr(vdd_m1b geomOr(  vdd_m1c  vdd_m1d ) ) )
TEMP0007 = geomAnd( CT TEMP0006 )
TEMP0008 = geomButtOrOver( ntie TEMP0007 )
TEMP0009 = geomAvoiding( NW TEMP0008 )
TEMP0010 = drc( TEMP0009 width < 2.1 withCornerTouch )
nw03     = geomAnd( TEMP0001 TEMP0010 )
errorLayer( nw03 " NW.3 Min. dimension of NW not connected to the most positive power supply 2.1um ")

;--------------------------------
; -----  5.2  NW Resistor  -----
;--------------------------------

nr01	  = drc( aawr  nwr4  enc < 1.0 )
errorLayer( nr01 "NR.1:  Min. extension of AA to NW 1.0um" )

ctwr      = geomAnd( dcont aawr )
nr02      = drc( nwr4  CT  enc < 0.3 )
errorLayer( nr02 "NR.2:  Min. enclosure of silicide NW beyond CT 0.3um") 

rhwr	  = geomAndNot( aawr SAB)
nr03 	  = drc( rhwr nwr4 enc < 0.3 )
errorLayer( nr03 "NR.3:  Min. space between SAB to related NW 0.3um")

nr04	  = drc( SAB aawr enc < 0.22 )
errorLayer( nr04 "NR.4:  Min. enclosure of SAB beyond related AA 0.22um")

npwr 	  = geomOverlap( SN nwr2 )
nr05	  = drc( npwr rhwr enc < 0.4)
errorLayer( nr05 "NR.5:  Min. enclosure of SN beyond SAB inside a NW 0.4um" )

nr06      = drc( ctwr SAB sep < 0.3 )
errorLayer( nr06 "NR.6: Min. space between SAB to a related CT in SAB hole ")

nr07      = drc( nwr4 sepNotch < 1.4 )
errorLayer( nr07 "NR.7: Min  NW space ") 

nr08a     = geomAnd( nwr3 SN )
nr08b     = geomAnd( nwr3 SP )
nr08c     = geomAnd( nwr3 NLL )
nr08d     = geomAnd( nwr3 NLH )
nr08e     = geomAnd( nwr3 PLL )
nr08f     = geomAnd( nwr3 PLH )
nr08      = geomOr( nr08a nr08b nr08c nr08d nr08e nr08f )
errorLayer( nr08 "NR.8: LDD,SN and SP implant inside NW resistance region is not allowed")

 



;-------------------------
; -----   5.3  AA   -----
;-------------------------

aa01 	  =  drc( AA width < 0.22 withCornerTouch )
errorLayer( aa01  "AA.1 & AA.2: Min. AA width 0.22um" )

aa03	  =  drc( AA  0 < sepNotch < 0.28 )
errorLayer( aa03 "AA.3: Min. space between AA 0.28um"  )

NR        = geomButtOrOver( NW RESNW )
N_NR      = geomAndNot( NW NR )
aa04	  = drc( N_NR ntie enc < 0.12 )
errorLayer( aa04 "AA.4: Min. NW enclosure of N-well pick-up 0.12um" )

aa05 	  = drc( nwOutRes nact sep < 0.43 )
errorLayer( aa05 "AA.5: Min. NW to N+AA space 0.43um" )

aa06 	  = drc( nwOutRes pact enc < 0.43 )
errorLayer( aa06 "AA.6: Min. NW enclosure of P+AA 0.43um" )

aa07 	  = drc( NW ptie sep < 0.12 )
errorLayer( aa07 "AA.7: Min. NW to P+AA (for PW pickup) space 0.12um" )

butntie	  = geomButtOnly( ntie paa )
butptie	  = geomButtOnly( ptie naa )
aa08a 	  = drc( butntie pgate sep < 0.32 )
aa08b	  = drc( butptie ngate sep < 0.32 )
aa08  	  = geomCat( aa08a aa08b )
errorLayer( aa08 "AA.8: Min. space between poly edge and edge of butted diffusion AA 0.32um" )

aa10a     = drc( butntie area < 0.176 )
aa10b     = drc( butptie area < 0.176 )
aa10ab    = geomCat( aa10a aa10b )
errorLayer( aa10ab " AA.10a: Min. area of butted diffusion AA 0.176um^2" )

aa10c01   = drc( butntie paa sep == 0 edgea opposite )
aa10c02   = geomGetLength( aa10c01 keep >= 0.42 )
aa10c03   = geomSize( aa10c02 0.005 )
aa10c04   = geomButtOrOver( butntie aa10c03 )
aa10c 	  = geomAndNot( butntie aa10c04 )

aa10d01   = drc( butptie naa sep == 0 edgea opposite )
aa10d02   = geomGetLength( aa10d01 keep >= 0.42 )
aa10d03   = geomSize( aa10d02 0.005 )
aa10d04   = geomButtOrOver( butptie aa10d03 )
aa10d	  = geomAndNot( butptie aa10d04 )

aa10      = geomCat( aa10c aa10d )
errorLayer( aa10 "AA.10: at least on length of butting AA edge 0.42um" )   	
 
aa11 	  = drc( AA area < 0.2 )
errorLayer( aa11 "AA.11: Min. area of stand-along AA 0.2um^2")

aa12  	  = drc( ntie ptie sep < 0.36 )
errorLayer( aa12  "AA.12:  Min. space of N-well and P-well pick-ups 0.36um" )

;---------------------------
; -----   5.4  DG    -----
;---------------------------

dgaa1     = geomInside( AA DG )
dgaa2     = geomStraddle( AA DG ) 
;dg1a  	  = drc( DG AA enc < 0.32 )
dg1a1  	  = drc( DG dgaa1 enc < 0.32 )
dg1a2     = drc( DG dgaa2 0<= enc < 0.32 )
dg1a      = geomOr( dg1a1 dg1a2 )
dg1b  	  = geomButting( lvgate hvgt )
;aadg	  = geomButtOrOver( AA DG )
;aaxdg 	  = geomAndNot( aadg DG )
;norLvgt  = geomAndNot( lvgate dg1b )
;noraaxdg  = geomButtOrOver( aaxdg norLvgt ) 
;dg1c 	  = geomAndNot( aaxdg noraaxdg )
dg1	  = geomCat(   dg1a dg1b )
errorLayer( dg1 "DG.1: Min. enclosure of DG beyond AA  0.32um" )


dg2	  = drc( DG sepNotch < 0.45 )
errorLayer( dg2 "DG.2: Min. DG space 0.45um" )

dg3a_1    = drc( DG pmos sep < .32 )
dg3a_2    = drc( DG nmos sep < .32 )
dg3a      = geomCat( dg3a_1 dg3a_2 )
errorLayer( dg3a "DG.3: Min. DG and AA( MOS AA ) space 0.32um" )

if( avSwitch( "DG_3b" ) then

dg3b1     = drc( DG ntie sep < 0.32 )
dg3b2     = drc( DG ptie sep < 0.32 )
dg3b      = geomOr( dg3b1 dg3b2 )
errorLayer( dg3b "DG.3: Min. DG and AA( Pick-up AA ) space 0.32um" )

); end DG_3b

dg4	  = drc( DG gate sep < .40 )
errorLayer( dg4 "DG.4: Min. DG and 1.8v transistor gate space 0.40um" )

dg5	  = drc( DG hvgtWEdg enc < 0.40 )
errorLayer( dg5 "DG.5: Min. enclosure of DG beyond 3.3v transistor gate 0.40um" )

;--------------------------
; -----   5.5  GT   -----
;--------------------------

gt01	  =  drc( GT width < 0.18 withCornerTouch )
errorLayer( gt01 "GT.1 & GT.2: Min. GT width 0.18um" )

gt03	  =  drc( GT sepNotch < 0.25 )
errorLayer( gt03 "GT.3 & GT.4: Min. space between GT 0.25um"  )

aa_gtedg  = geomGetEdge( AA inside GT )
gt05	  =  drc( GT aa_gtedg enc < 0.22 )
errorLayer( gt05 "GT.5: Min. GT enclosure of AA 0.22um" )

gt06a     =  geomGetEdge( GT inside AA )
gt06      =  drc( AA gt06a enc < 0.32 )
errorLayer( gt06 "GT.6: Min. AA enclosure of GT 0.32um" )

gt07	  = drc( GT AA  sep < 0.10 withSingularPoint withIntersection )
errorLayer( gt07 "GT.7: Min. GT to AA space 0.10um" )

dpgate 	  =  geomInside( pgate DG )
gt08tmp   =  geomAnd( dpgate pgateEdgeW )
gt08	  =  drc( gt08tmp width < 0.30 withCornerTouch )
errorLayer( gt08 "GT.8: Min. width of GT for 3.3v PMOS 0.30um" )

dngate	  =  geomInside( ngate DG )
;gt09	  =  drc( dngate width < 0.35 )
gt09tmp   =  geomAnd( dngate ngateEdgeW )
gt09      =  drc( gt09tmp width < 0.35 )
errorLayer(  gt09 "GT.9: Min. width of  GT for 3.3v NMOS 0.35um" )

gt_ct		= geomAnd( GT CT )
gt_with_ct1	= geomEnclose( GT CT )
gt_with_ct	= geomOr( gt_with_ct1 )

gtct_grow	= geomSizeAnd( gt_ct gt_with_ct 0.1 25 )
more_dis	= geomAndNot( gt_with_ct gtct_grow )
gt10x	 	= geomButtOnly( more_dis gtct_grow keep >= 2 )
gt10y	        = geomButtOrOver( gt_with_ct gt10x )
gt10b           = drc( gt10y 0< width <= 0.24 )  
errorLayer( gt10b "GT.10b: Max. length of poly between two contacts 50um" )

gt_inter        = geomAndNot( GT gate )
gt_thin         = drc( gt_inter 0< width <= 0.24 )
gt_thininter    = geomButtOrOver( gt_inter gt_thin )
inter_ct        = geomAnd( CT gt_thininter ) 
gt_encct        = geomEnclose( gt_inter CT keep==1 )
gtct_growa      = geomSizeAnd( inter_ct gt_encct 0.1 50 )
gt10a1          = geomAndNot(gt_encct gtct_growa )
gt10a           = geomStraddle( gt_thin gt10a1 )
errorLayer( gt10a "GT.10a: Max. length of salicide poly on STI between one contact and poly line end when poly width <=0.24" )


;gt_w_bend = geomGetNonRectangle( gate )
gt_w_bend = geomGetVertex( gate 5<= keep <= 1000 ) 
gt11x	  = geomGetCorner( gt_w_bend angleMulti90 )
gt11y	  = geomGrowCorner( gt11x 0.01 angleMulti90 outside )
gt11a     = geomAnd( gt11y AA )
gt11b     = geomInside( GT AA)
gt11      = geomCat( gt11a gt11b )
errorLayer( gt11 "GT.11: 90 degrees bends on active area are not allowed" )   	

density( GT_e 0.14 )
errorLayer( coverage_error "GT.12: Min. GT density must be greater than 14%" )

gt13_1	  = geomButtOrOver( allsd CT )
;gt13_2	  = drc( gate sepNotch < 0.375 )
gt13_2    = drc( gate sepNotch < 0.375 opposite )
gt13	  = geomAnd( gt13_1 gt13_2 )
errorLayer( gt13 "GT.13: Min. space between two GT's with CT on active area  0.375um" )

gate45    = geomGetAngledEdge( gate keep == 45  )
gt14      = drc( gate45 width < 0.21 opposite )
errorLayer(gt14 "GT.14: Min. channel length of 1.8v device poly gate on AA with 45 degree bent " )


;-----------------------------------
; -----  5.6  POLY resistor  -----
;-----------------------------------

if( avSwitch( "GT_Res" ) then

gt_r1     = drc( geomGetEdge( polyRes inside SAB ) width < 2 withCornerTouch )
errorLayer( gt_r1 "GT_Res.1: Min. poly resistor width 2.0um" )

polyCont  = geomButtOrOver(geomButtOrOver( polyRes SAB ) CT)
sab_res   = geomButtOrOver( SAB polyCont )
sabres_gr = geomInside( CT polyCont)
gr2_expct=geomSize(sabres_gr 0.22 autoSteps(0.05)) 
polyConBut= geomButtOnly(gr2_expct sab_res)
gt_r2  	  = geomAndNot(gr2_expct polyConBut)
errorLayer( gt_r2 "GT_Res.2 separation from SAB to contact on poly must be equal to 0.22um" )


gt_r3	  = drc( SAB polyRes sep < 0.3 )
errorLayer( gt_r3 "GT_Res.3 space from an un-related SAB to resistor poly must larger than 0.3um" )

; "GT_Res.5 the contact to pick-up poly resister should be single column "

gt_r4a	  = drc( n_polyRes SP sep < 0.26 )
gt_r4b	  = drc( n_polyRes PLL sep < 0.26 )
gt_r4c	  = drc( p_polyRes SN sep < 0.26 )
gt_r4d	  = drc( p_polyRes NLL sep < 0.26 )
gt_r4e	  = drc( polyRes PLH sep < 0.26 )
gt_r4f	  = drc( polyRes NLH sep < 0.26 )
gt_r4	  = geomCat( gt_r4a gt_r4b gt_r4c gt_r4d gt_r4e gt_r4f )
errorLayer( gt_r4 "GT_Res.4 Min. space from un-related SAB implant to resistor poly 0.26um" )

gt_r6 	  = geomAndNot( polyRes geomGetRectangle( polyRes ) )
errorLayer( gt_r6 "GT_Res.6 dog-bone at the end of poly resistor for contact pick-up is not allowed" )
)

;------------------------
; -----  5.7  NLL -----
;------------------------

nll01	  = drc( NLL width < 0.44 withCornerTouch )
errorLayer( nll01 "NLL.1: Min. NLL width 0.44um" )

nll02	  = drc( NLL 0 < sepNotch < 0.44 )
errorLayer( nll02 "NLL.2: Min. space um between NLL 0.44um"  )

nll03	  = drc( NLL pact 0 < sep < 0.26 )
errorLayer( nll03 "NLL.3: Min. space of NLL to P+AA 0.26um"  )

nll04	  = drc( NLL ptie  0 < sep < 0.10 )
errorLayer( nll04 "NLL.4: Min. space between NLL and P+ pick-up AA region 0.1um" )

nll05	  = drc( NLL AA  ovlp < 0.23 )
errorLayer( nll05 "NLL.5: overlay from an NLL edge to an AA 0.23um" )

nll06 	  = drc( NLL nsd 0 < enc < 0.18 )
errorLayer( nll06 "NLL.6: Min. enclosure of NLL over SN active region 0.18um" )

nlhaa  	  = geomAnd( NLH AA )
nll07     = drc( NLL nlhaa 0 < sep < 0.21 )
errorLayer( nll07 "NLL.7: Min. space between NLL and an NLH AA region 0.21um" )

nll08	  = drc( NLL ngt35EdgeW  enc < 0.32 oppositeB )
errorLayer( nll08 "NLL.8:Min. enclosure of NLL to an N-channel poly gate 0.32um" )

nll09	  = drc( NLL area < 0.4 )
errorLayer( nll09 "NLL.9: Min. area of NLL 0.4um") 

nll10 	  = geomAnd( NLL paa )
errorLayer( nll10 "NLL.10: NLL and SP overlap is not allowed" )

aaNoNLL   = geomAndNot( AA NLL )
aaNoLH 	  = geomAndNot( aaNoNLL NLH )
nll11a	  = geomButtOnly( aaNoLH NLL )
nll11b    = geomButtOnly( nll11a NLH )
nll11c    = geomAnd( NLL NLH )
nll11     = geomCat( nll11b nll11c )
errorLayer( nll11 "NLL.11: Min. space 0.0um between NLL and NLH if two AAs are overlaped")

nll12	  = drc( NLL ngateEdgeL enc < 0.35 )
errorLayer( nll12 "NLL.12: Min. enclosure of NLL over N-channel along the direction of poly gate 0.35um") 

aares    = geomStraddle( AA RESAA )
saba1    = geomStraddle( aares SAB )

nll14a    = geomAnd( saba1 NLL )
nll14b    = geomAnd( NLL geomAnd( polyRes SAB ) )
nll14     = geomOr( nll14a nll14b )
errorLayer(nll14 "NLL.14:NLL implant is not allowed in non-salicide AA/POLY resistor region ")

;---------------------------
; -----   5.8  PLL   -----
;---------------------------

pll01	  = drc( PLL width < 0.44 withCornerTouch )
errorLayer( pll01 "PLL.1 Min. PLL width 0.44um" )

pll02	  = drc( PLL 0 < sepNotch < 0.44 )
errorLayer( pll02 "PLL.2 Min. space between PLL 0.44um"  )

pll03	  = drc( PLL nact 0 < sep < 0.26 )
errorLayer( pll03 "PLL.3 Min. space of PLL to N+AA 0.26um"  )

pll04	  = drc( PLL ntie  0 < sep < 0.10 )
errorLayer( pll04 "PLL.4  Min. space between PLL and N+ pick-up AA region 0.1um" )

pll05	  = drc( PLL AA  ovlp < 0.23 )
errorLayer( pll05 "PLL.5 overlay from an PLL edge to an AA 0.23um" )

pll06 	  = drc( PLL psd 0 < enc < 0.18 )
errorLayer( pll06 "PLL.6 Min. enclosure of PLL over SP active region 0.18um" )

plhaa  	  = geomAnd( PLH AA )
pll07     = drc( PLL plhaa 0 < sep < 0.21 )
errorLayer( pll07 "PLL.7: Min. space between PLL and an NLH AA region 0.21um" )

pll08	  = drc( PLL pgt35EdgeW  enc < 0.32 oppositeB )
errorLayer( pll08 "PLL.8: Min. enclosure of PLL to an P-channel poly gate 0.32um" )

pll09	  = drc( PLL area < 0.4 )
errorLayer( pll09 "PLL.9: Min. area of PLL 0.4um ") 

pll10 	  = geomAnd( PLL naa ) 
errorLayer( pll10 "PLL.10: Separation from an PLL to butted edge of butted diffusion n+AA(inside N-Well) 0.0um") 

aaNoPLL   = geomAndNot( AA PLL )
aaNopLH   = geomAndNot( aaNoPLL PLH )
pll11a	  = geomButtOnly( aaNopLH PLL )
pll11b    = geomButtOnly( pll11a PLH )
pll11c    = geomButtOnly( PLL PLH )
pll11     = geomCat( pll11b pll11c )
errorLayer( pll11 "PLL.11: Min. space 0.0um between PLL and PLH if two AAs are overlaped")
pll12	  = drc( PLL pgateEdgeL enc < 0.35 )
errorLayer( pll12 "PLL.12: Min. enclosure 0.35um of PLL over P-channel along the direction of poly gate 0.35um ") 

pll14a   = geomAnd( PLL saba1 ) 
pll14b   = geomAnd( PLL geomAnd( polyRes SAB ) )  
pll14    = geomOr( pll14a pll14b )
errorLayer( pll14 "PLL.14 :NLH implant is not allowed in non-salicide AA/poly resistor region" )
;---------------------------
; -----   5.9  NLH   -----
;---------------------------

nlh01	  = drc( NLH width < 0.44 withCornerTouch )
errorLayer( nlh01 "NLH.1 Min. NLH width 0.44um" )

nlh02	  = drc( NLH 0 < sepNotch < 0.44 )
errorLayer( nlh02 "NLH.2 Min. space between NLH 0.44um"  )

nlh03	  = drc( NLH pact 0 < sep < 0.26 )
errorLayer( nlh03 "NLH.3 Min. space of NLH to P+AA 0.26um"  )

nlh04	  = drc( NLH ptie 0 < sep < 0.10 )
errorLayer( nlh04 "NLH.4  Min. space between NLH and P+ pick-up AA region 0.10um" )

nlh05	  = drc( NLH AA  ovlp < 0.23 )
errorLayer( nlh05 "NLH.5 overlay from an NLH edge to an AA 0.23um" )

nlh06 	  = drc( NLH nsd 0 < enc < 0.18 )
errorLayer( nlh06 "NLH.6 Min. enclosure of NLH over SN active region 0.18um" )

nllaa  	  = geomAnd( NLL AA )
nlh07     = drc( NLH nllaa 0 < sep < 0.21 )
errorLayer( nlh07 "NLH.7: Min. space between NLH and an NLL AA region 0.21um" )

nlh08	  = drc( NLH ngt35EdgeW  enc < 0.32 oppositeB )
errorLayer( nlh08 "NLH.8: Min. enclosure of NLH to an N-channel poly gate 0.32um" )

nlh09	  = drc( NLH area < 0.4 )
errorLayer( nlh09 "NLH.9: Min. area of NLH 0.4um") 

nlh10 	  = geomAnd( NLH paa )
errorLayer( nlh10 "NLH.10: NLH and SP overlap is not allowed" )


;nlh11	  = geomAnd( NLH NLL )
;errorLayer( nlh11 "NLH.11: Min. space 0.0 of NLH and NLL ")

nlh12	  = drc( NLH ngateEdgeL enc < 0.35 )
errorLayer( nlh12 "NLH.12: Min. enclosure of NLH over N-channel along the direction of poly gate 0.35um") 

nlh14a    = geomAnd( NLH saba1 )
nlh14b    = geomAnd( NLH geomAnd( polyRes SAB ) )
nlh14     = geomOr( nlh14a nlh14b )
errorLayer( nlh14 "NLH.14: NLH implant is not allowed in non-salicide AA/poly resistor region " )

;---------------------------
; -----   5.10  PLH   -----
;---------------------------

plh01	  = drc( PLH width < 0.44 withCornerTouch )
errorLayer( plh01 "PLH.1: Min. PLH width 0.44um" )

plh02	  = drc( PLH 0 < sepNotch < 0.44 )
errorLayer( plh02 "PLH.2: Min. space between PLH 0.44um"  )

plh03	  = drc( PLH nact 0 < sep < 0.26 )
errorLayer( plh03 "PLH.3: Min. space of PLH to N+AA 0.26um"  )

plh04	  = drc( PLH ntie 0 < sep < 0.10 )
errorLayer( plh04 "PLH.4: Min. space between PLH and N+ pick-up AA region 0.1um" )

plh05	  = drc( PLH AA  ovlp < 0.23 )
errorLayer( plh05 "PLH.5: overlay from an PLH edge to an AA 0.23um" )

plh06 	  = drc( PLH psd 0 < enc < 0.18 )
errorLayer( plh06 "PLH.6: Min. enclosure of PLH over SP active region 0.18um" )

pllaa  	  = geomAnd( PLL AA )
plh07     = drc( PLH pllaa 0 < sep < 0.21 )
errorLayer( plh07 "PLH.7: Min. space between PLH and an NLH AA region 0.21um" )

plh08	  = drc( PLH pgt35EdgeW  enc < 0.32 oppositeB )
errorLayer( plh08 "PLH.8: Min. enclosure of PLH to an P-channel poly gate 0.32um" )

plh09	  = drc( PLH area < 0.4 )
errorLayer( plh09 "PLH.9: Min. area of PLH 0.4um") 

plh10 	  = geomAnd( PLH naa )
errorLayer( plh10 "PLH.10: PLH and SN overlap is not allowed" )

plh12	  = drc( PLH pgateEdgeL enc < 0.35 )
errorLayer( plh12 "PLH.12: Min. enclosure of PLH over P-channel along the direction of poly gate 0.35um") 

plh14a    = geomAnd( PLH saba1 )
plh14b    = geomAnd( PLH polyRes )
plh14     = geomOr( plh14a plh14b )
errorLayer( plh14 "PLH.14: PLH implant is not allowed in non-salicide AA/poly resistor region" )

;-------------------------
; -----   5.11 SN   -----
;-------------------------

sn01	  = drc( SN  width < 0.44 withCornerTouch )
errorLayer( sn01 "SN.1:  Min. width of SN 0.44um" )

sn02	  = drc( SN  sepNotch < 0.44 )
errorLayer( sn02 "SN.2:  Min. space between two SN 0.44um" )

sn03tmp   = geomGetEdge( pmos outside SN )
sn03      = drc( SN sn03tmp 0 < sep < 0.26 )
errorLayer( sn03 "SN.3:  Min. space between SN and P+AA region (inside Nwell) 0.26um" )

sn04	  = drc( SN  ptie 0 < sep < 0.1 ) 
errorLayer( sn04 "SN.4:  Min. space between SN and P+ pick-up AA region 0.1um" )

nw43big	  = geomSize( NW 0.43 )
ptieNearNW= geomAnd( ptie nw43big )
sn05	  = drc( SN ptieNearNW sep < 0.18 ) 
errorLayer( sn05 "SN.5:  Min. space between SN and non-butted edge of Pwell pick-up P+AA region region 0.18um" )

butsn	= geomButtOrCoin( SN naa )
sn06	  = drc( butsn pgt35EdgeW 0< sep < 0.32 oppositeB )
errorLayer( sn06 "SN.6:  Min. space from SN edge to P-channel Poly gate 0.32um" )

sn07	  = drc( butsn ngt35EdgeW 0 < enc < 0.32 oppositeB )
;sn07	  = drc( butsn ngate 0 < enc < 0.32 oppositeB )
;sn07	  = drc( butsn ngateEdgeW 0 < enc < 0.32 oppositeB )
errorLayer( sn07 "SN.7:  Min. enclosure of SN edge to an N-Channel Poly gate 0.32um" )

sn08	  = drc( butsn AA 0< ovlp < 0.23 )
errorLayer( sn08 "SN.8:  Min. overlap from SN edge to an AA 0.23um" )

sn09	  = drc( SN nact 0 < enc < 0.18 )
errorLayer( sn09 "SN.9:  Min. enclosure of SN beyond SN active region 0.18um" )



nw_usize  = geomSize( NW -0.43 )
aa        = geomAndNot( AA OPCBA )
aar       = geomButtOrOver( geomInside( NW aa ) RESNW )
newntie = geomAndNot( ntie geomGetEdge( ntie butting pact wholeEdge))
new1 = geomAndNot( NW nw_usize )
new3 = geomGetEdge( geomAndNot(newntie aar ) inside new1 )
new2 = geomGetEdge( geomAndNot(newntie aar ) inside nw_usize)
new10 = geomGetEdge( geomAndNot(newntie aar ) coincident nw_usize)
sn_10a = drc( SN new2 enc < 0.02 shielded opposite)
sn_10b = drc( SN new10 enc < 0.02 shielded opposite)
sn_11 = drc( SN new3 enc < 0.18 shielded opposite)
errorLayer( geomCat( sn_10a sn_10b) "SN_10:Minimum enclosure of a SN region beyond an N+ pick-up AA region is 0.02um" )
errorLayer( sn_11 "SN_11:Minimum enclosure of a SN region beyond an N+ pick-up AA region is 0.18um" )

ntieFarNW = geomAnd( ntie nw_usize )
ntieNearNW= geomAndNot( ntie nw_usize )

; SN.12&SN.13 included in SN.18

sn14	  = drc( SN area < .38 )
errorLayer( sn14 "SN.14: Min. area of SN 0.38um^2" )

sn15a	  = drc( SN all_polyr_nosp enc < 0.18 )
errorLayer( sn15a "SN.15a: Min. extension of SN beyond poly as resistor 0.18um" )

sn15b     = geomButtOrOver( all_polyr_nosp SAB )
sn15c     = geomAndNot( geomAndNot( sn15b SN ) SP )
errorLayer( sn15c "SN.15c&SP.15c: SAB poly without SN or SP implant is not allowed" )

sn16      = drc( SN pgateEdgeL sep < 0.35 )
errorLayer( sn16 "SN.16: Min. space from SN edge to P-Channel Poly gate along the direction of poly gate 0.35um" )

sn17	  = drc( SN ngateEdgeL enc < 0.35 )
errorLayer( sn17 "SN.17: Min. enclosure of SN edge to N-channel Poly gate along the direction of poly gate 0.35um" )

sn18            = geomAnd( SNi SPi )
errorLayer( sn18 "SN.18&SP.18:  Overlap of SN and SP is forbidden" )

;-------------------------
; -----   5.12 SP   -----
;-------------------------

sp01	  = drc( SP  width < 0.44 withCornerTouch )
errorLayer( sp01 "SP.1:  Min. width of SP 0.44um" )

sp02	  = drc( SP sepNotch < 0.44 )
errorLayer( sp02 "SP.2:  Min. space between SP 0.44um" )

sp03	  = drc( SP  nsd  0 < sep < 0.26 shielded )
errorLayer( sp03 "SP.3:  Min. space between SP and N+AA region (inside Nwell) 0.26um" )

sp04	  = drc( SP  ntie 0 < sep < 0.1 ) 
errorLayer( sp04 "SP.4:  Min. space between SP and N+ pick-up AA region 0.1um" )

pb_over = geomSize( PWa 0.425 )
tmp_pb  = geomAndNot( pb_over PWa )
tmp1    = geomAnd( ntie pb_over )
tmp2    = geomAndNot( ntie pb_over )
tmp3    = geomGetEdge( SP outside AA )
sp05a   = drc( tmp1 tmp3 sep < 0.18 opposite )
sp05b   = drc( tmp2 tmp3 sep < 0.10 opposite )
sp05    = geomCat( sp05a sp05b )
errorLayer( sp05 "SP.5: Min.space between SP and non-butted edge of Nwell pick-up N+AA region is 0.18um" )

butsp	= geomButtOrCoin( SP paa )
sp06	  = drc( butsp ngt35EdgeW 0< sep < 0.32 oppositeB )
errorLayer( sp06 "SP.6:  Min. space from SP edge to N-channel Poly gate 0.32um" )

sp07	  = drc( butsp pgt35EdgeW 0 < enc < 0.32 oppositeB )
errorLayer( sp07 "SP.7:  Min. enclosure of SP edge to an P-Channel Poly gate 0.32um" )

sp08	  = drc( butsp AA 0 < ovlp < 0.23 )
errorLayer( sp08 "SP.8:  Min. overlap from SP edge to an AA 0.23um" )

sp09	  = drc( SP pact 0 < enc < 0.18 )
errorLayer( sp09 "SP.9:  Min. enclosure of SP beyond SP active region 0.18um" )


pw_usize  = geomSize( NW 0.43 )
pwell = geomAndNot( bulk pw_usize )
new4 = geomAndNot(  pw_usize NW)
newptie = geomAndNot( ptie geomGetEdge( ptie butting nact wholeEdge))
new5 = geomGetEdge( newptie inside new4 )
new6 = geomGetEdge( newptie inside pwell )
new7 = geomGetEdge( newptie coincident pwell )
sp_10a =  drc( SP new6  enc < 0.02 opposite )
sp_10b =  drc( SP new7  enc < 0.02 opposite )
sp_11  =  drc( SP new5  enc < 0.18 opposite )
errorLayer( geomCat(sp_10a sp_10b) "SP.10: Minimum enclosure of a SP region beyond an P+ pick-up AA region is 0.02um" )
errorLayer( sp_11 "SP.11: Minimum enclosure of a SP region beyond an P+ pick-up AA region is 0.18um" )

; SP.12&SP.13 included in SP.18


sp14	  = drc( SP area < .38 )
errorLayer( sp14 "SP.14: Min. area of SP 0.38um^2" )

/*
sp15a     = drc( SP all_polyr_nohrp3t enc < 0.18 )
errorLayer( sp15a "SP.15a: Min. extension of SP beyond poly as resistor 0.18um" )

sphr_a    = geomButtOrOver( gt_res SAB )
sphr_a1   = geomAndNot( sphr_a SN )
sphr_b    = geomAndNot( sphr_a1 SP )
sphr_c    = geomAndNot( geomAndNot( gt_hrp hr_gt ) SP )
sphr      = geomCat( sphr_b sphr_c )
errorLayer( sphr "SP.15b:Minimum extension of a SP region beyond a poly as a resistor" )
*/
sp15tmp   = geomGetEdge( all_polyr_nosp outside HRPDMY )
sp15a     = drc( SP sp15tmp enc < 0.18 )
sp15b     = geomAndNot( all_hrpr_nosp SP )
sp15_a    = geomCat( sp15a sp15b )
errorLayer( sp15_a "SP.15a: Min. extension of SP beyond poly as resistor 0.18um" )


sp16	  = drc( SP ngateEdgeL sep < 0.35 )
errorLayer( sp16 "SP.16: Min. space from SP edge to N-Channel Poly gate along the direction of poly gate 0.35um" )

sp17	  = drc( SP pgateEdgeL enc < 0.35 )
errorLayer( sp17 "SP.17: Min. enclosure of SP edge to P-channel Poly gate along the direction of poly gate 0.35um" )

;--------------------------
; -----  5.13 SAB   -----
;--------------------------

sab01	  = drc( SAB width < 0.43 withCornerTouch ) 
errorLayer( sab01 "SAB.1: Min. width 0.43um" )

sab02	  = drc( SAB 0 < sepNotch < 0.43 ) 
errorLayer( sab02 "SAB.2: Min. space 0.43um" )

sab03	  = drc( SAB AA sep < 0.22 ) 
errorLayer( sab03 "SAB.3: Min. space to unrelated diffusion 0.22um" )

sab04	  = drc( SAB CT sep < 0.22 )  
errorLayer( sab04 "SAB.4: Min. space to contact 0.22um" )

sab05a	  = drc( SAB ngateEdgeW sep < 0.45 )
sab05b	  = drc( SAB pgateEdgeW sep < 0.45 )
sab05	  = geomCat( sab05a sab05b ) 
errorLayer( sab05 "SAB.5: Min. space to poly on diffusion 0.45um" )

sab06	  = drc( SAB AA  enc < 0.22 )
errorLayer( sab06 "SAB.6: Min. extension over related diffusion 0.22um" )

sab07	  = drc( AA SAB enc < 0.22 ) 
errorLayer( sab07 "SAB.7: Min. extension of diffusion over related SAB 0.22um" )

sab08	  = drc( SAB polyRes enc < 0.22 ) 
errorLayer( sab08 "SAB.8: Min. extension over related poly on field oxide 0.22um" )

sab09tmp  = geomAndNot( GT gate )
sab09	  = drc( SAB sab09tmp sep < 0.30 ) 
errorLayer( sab09 "SAB.9: Min. space of SAB to unrelated poly on field oxide 0.30um" )

sab10	  = drc( SAB area < 2.00 ) 
errorLayer( sab10 "SAB.10: Min. area of SAB 2.00um" )

;--------------------------
; -----   5.14 CT   -----
;--------------------------

act_ct    = geomAnd( CT act )

ct01 	  = geomContactCheck( CT_excl_opm1 length == .22 width == .22 ignore )
errorLayer( ct01 "CT.1:  Min. and max. width of CT is 0.22um" )

ct02	  = drc( CT_excl_opm1 sep < 0.25 )
errorLayer( ct02 "CT.2:  Min. space 0.25um" )

ctsizing  = geomSize( CT 0.14 )
ctarray	  = geomWidth( ctsizing keep >= 1.90 )
ct1to15	  = geomStraddle( ctarray CT 1 <= keep <= 15 )
ct16more  = geomAndNot( ctarray ct1to15 )
ct4x4	  = geomAnd( CT_excl_opm1 ct16more )
ct03	  = drc( ct4x4 sep < 0.28 )
errorLayer( ct03 "CT.3:  Min. space 0.28um in array which is greater than 4x4" )

ctgt	  = geomAndNot( CT_excl_opm1 AA )
ct04	  = drc( ctgt AA sep < 0.20 ) 
errorLayer( ct04 "CT.4:  Min. space between poly contact to AA 0.20um" )

ct05	  = drc( act_ct gate sep < 0.16 )
errorLayer( ct05 "CT.5:  Min. space between poly to diffusion contact 0.16um" )

ct06	  = drc( AA dcont enc < 0.10 )
errorLayer( ct06 "CT.6:  Min. enclosure of AA beyond an AA CT region 0.10um" )

ct07	  = drc( GT ctgt enc < 0.10 ) 
errorLayer( ct07 "CT.7:  Min. enclosure of poly beyond poly CT region 0.10um" )

ct06b     = geomAndNot(geomAndNot( CT_excl_opm1 GT ) AA)
errorLayer( ct06b "CT.Note:CT outside GT or AA is not allowed")

ct08	  = drc( SP act_ct enc < 0.12 )
errorLayer( ct08 "CT.8:  Min. enclosure of SP beyond an AA CT region 0.12um" )

act_ct    = geomAnd( CT act )
ct09	  = drc( SN act_ct enc < 0.12 )
errorLayer( ct09 "CT.9:  Min. enclosure of SN beyond an AA CT region 0.12um" )

ct10	  = geomAnd( CT gate )
errorLayer( ct10 "CT.10: CT on gate is forbidden" )

ct11a 	  = geomOverlap( dcont SN )
ct11	  = geomOverlap( ct11a SP ) 
errorLayer( ct11 "CT.11: AA contact located on NP/PP boundary is no allowed" )

ct12	  = geomAnd( CT SAB )  
errorLayer( ct12 "CT.12: Salicided contacts are not allowed" )


;------------------------
; -----  5.15 M1  -----
;------------------------
;  --* Find Wide Metal *--//

   wide_m1 = geomButtOrOver( M1 geomSize( M1 -5))
;  begin shrink
   wdm1_45 = geomGetAngledEdge( wide_m1  0 < keep < 90 )
   wdm1_90 = geomGetAngledEdge( wide_m1  0 < ignore < 90 )


   wdm1_exp_45 = geomSize( wdm1_45 -7.070 edges )
   wdm1_exp_90 = geomSize( geomStretch( wdm1_90 5 ) -5 edges )

   thin_m1_tmp = geomAndNot( wide_m1  geomOr( wdm1_exp_45 wdm1_exp_90 ) )
   thin_m1 = geomSnap( thin_m1_tmp 0.001 )  ;  end of shrink

;  begin grow
   tnm1_45 = geomGetAngledEdge( thin_m1  0 < keep < 90 )
   tnm1_90 = geomGetAngledEdge( thin_m1  0 < ignore < 90 )


   tnm1_exp_45_tmp = geomSize( tnm1_45 7.070 edges )
   tnm1_exp_45 = geomSnap( tnm1_exp_45_tmp 0.001 )
   tnm1_exp_90 = geomSize( geomStretch( tnm1_90 5 ) 5 edges )

   tnm1_exp = geomOr( tnm1_exp_45 tnm1_exp_90 )

   wdm1_pre = geomOr( tnm1_exp thin_m1 )
   wdm1_pre_fill = drc( wdm1_pre sep< 5  shielded opposite withSingularPoint withIntersection)

   m1over10 = geomOr( wdm1_pre wdm1_pre_fill )
;  end of grow

;  --* End of Finding Wide Metal *--//

m101  	  = drc( M1 width < 0.23 withCornerTouch )
errorLayer( m101 "M1.1:  Min. width 0.23um" )

m102  	  = drc( M1 sepNotch < 0.23 ) 
errorLayer( m102 "M1.2:  Min. space 0.23um" )


m103a	  = geomAndNot( CT_excl_opm1 M1 )
m103b  	  = drc( M1 CT_excl_opm1 enc < 0.005 ) 
m103  	  = geomCat( m103a m103b )
errorLayer( m103 "M1.3:  Min. enclosure of M1 over CT 0.005um" )

ctm1fast_venc    = drc(  M1 CT enc < 0.06 oppositeB withIntersection edgeb )
ctm1t1     = geomGetAngledEdge( ctm1fast_venc keep ==0 mode1)
ctm1t2     = geomGetAdjacentEdge( ctm1fast_venc ctm1t1 )
ctm1t3     = geomGetAngledEdge( ctm1fast_venc keep ==45 )
m104       = geomAndNot( ctm1t2 ctm1t3 )
errorLayer( m104 "M1.4:Min. enclosure of M1 line end beyond V1 0.06" )


TEMP0180 = geomSizeAnd( wdm1_pre wide_m1 0.148 1.0 )
TEMP0181 = drc( TEMP0180 M1 0 < sep < 0.60 )
TEMP0182 = geomButtOrOver( M1 TEMP0180 )
TEMP0183 = geomSize( TEMP0181 .001 clipAcute )
TEMP0184 = geomAnd( TEMP0183 M1 )
TEMP0185 = geomButtOrOver( TEMP0181 TEMP0184 keep == 1 )
M1_5     = geomAndNot( TEMP0181 TEMP0185 )
errorLayer( M1_5 "M1.5 Minimum space between M1 lines with one or both metal line width&and length are greater than 10um is 0.60um @ The minimum space must be maintained between a metal line and a&small piece of metal(<10) that is connected to the wide metal" )

m106  	  = drc( M1 area < 0.20 ) 
errorLayer( m106 "M1.6:  Min. area 0.20um^2" )

density( M1_e 0.30 )
errorLayer( coverage_error "M1.7: Min. M1 density 30%" )
/*
m1dump 	  = drc( drc( M1 area == 10 ) width == 2.0 )
m108a  	  = geomAndNot( M1DUM m1dump )  
m108b	  = drc( M1 M1DUM sep < 2.0 )
dev 	  = geomCat( AA GT RESNW )
m108c	  = geomAnd( dev M1DUM ) 
m108	  = geomCat( m108a m108b m108c )
errorLayer( m108 "Dummy metal spacing > 1.0um" )
*/
dev       = geomCat( AA GT RESNW )
 
   if( !avSwitch( "top_m2" ) then
;-------------------------
; -----   5.16 V1  -----
;-------------------------

  v101	   = geomContactCheck( V1 length == 0.26 width == 0.26 ignore )    
  errorLayer( v101 "V1.1: Min/max V1 size 0.26x0.26" )

  v102	   = drc( V1 sep < 0.26 )  
  errorLayer( v102 "V1.2: Min. space between two V1 0.26um" )

  v103a	   = geomAndNot( V1 M1 )
  v103b	   = drc( M1 V1 enc < 0.01 )   
  v103	   = geomCat(v103a v103b)    
  errorLayer( v103 "V1.3: Min. M1 enclosure for V1 0.01um" )

v1m1fast_venc    = drc(  M1 V1 enc < 0.06 oppositeB withIntersection edgeb )
v1m1t1     = geomGetAngledEdge( v1m1fast_venc keep ==0 mode1)
v1m1t2     = geomGetAdjacentEdge( v1m1fast_venc v1m1t1 )
v1m1t3     = geomGetAngledEdge( v1m1fast_venc keep ==45 )
v104       = geomAndNot( v1m1t2 v1m1t3 )
errorLayer( v104 "V1.4:Min. enclosure of M1 line end beyond V1 0.06" )


;--------------------------
; -----   5.17 M2   -----
;--------------------------

;  --* Find Wide Metal *--//

   wide_m2 = geomButtOrOver( M2 geomSize( M2 -5))
;  begin shrink
   wdm2_45 = geomGetAngledEdge( wide_m2  0 < keep < 90 )
   wdm2_90 = geomGetAngledEdge( wide_m2  0 < ignore < 90 )


   wdm2_exp_45 = geomSize( wdm2_45 -7.070 edges )
   wdm2_exp_90 = geomSize( geomStretch( wdm2_90 5 ) -5 edges )

   thin_m2_tmp = geomAndNot( wide_m2  geomOr( wdm2_exp_45 wdm2_exp_90 ) )
   thin_m2 = geomSnap( thin_m2_tmp 0.001 )  ;  end of shrink

;  begin grow
   tnm2_45 = geomGetAngledEdge( thin_m2  0 < keep < 90 )
   tnm2_90 = geomGetAngledEdge( thin_m2  0 < ignore < 90 )


   tnm2_exp_45_tmp = geomSize( tnm2_45 7.070 edges )
   tnm2_exp_45 = geomSnap( tnm2_exp_45_tmp 0.001 )
   tnm2_exp_90 = geomSize( geomStretch( tnm2_90 5 ) 5 edges )

   tnm2_exp = geomOr( tnm2_exp_45 tnm2_exp_90 )

   wdm2_pre = geomOr( tnm2_exp thin_m2 )
   wdm2_pre_fill = drc( wdm2_pre sep< 5  shielded opposite withSingularPoint withIntersection)

   m2over10 = geomOr( wdm2_pre wdm2_pre_fill )
;  end of grow

;  --* End of Finding Wide Metal *--//


m201  	  = drc( M2  width < 0.28 withCornerTouch )
errorLayer( m201 "M2.1:  Min. width 0.28um" )

m202  	  = drc( M2 sepNotch < 0.28 ) 
errorLayer( m202 "M2.2:  Min. space 0.28um" )

m203a	  = geomAndNot( V1 M2 )
m203b  	  = drc( M2 V1 enc < 0.01 ) 
m203	  = geomCat( m203a m203b )
errorLayer( m203 "M2.3:  Min. enclosure of M2 over V1 0.01um" )

v1m2fast_venc    = drc(  M2 V1 enc < 0.06 oppositeB withIntersection edgeb )
v1m2t1     = geomGetAngledEdge( v1m2fast_venc keep ==0 mode1)
v1m2t2     = geomGetAdjacentEdge( v1m2fast_venc v1m2t1 )
v1m2t3     = geomGetAngledEdge( v1m2fast_venc keep ==45 )
m204       = geomAndNot( v1m2t2 v1m2t3 )
errorLayer( m204 "M2.4:Min. enclosure of M2 line end beyond V1 0.06" )

TEMP0280 = geomSizeAnd( wdm2_pre wide_m2 0.148 1.0 )
TEMP0281 = drc( TEMP0280 M2 0 < sep < 0.60 )
TEMP0282 = geomButtOrOver( M2 TEMP0280 )
TEMP0283 = geomSize( TEMP0281 .001 clipAcute )
TEMP0284 = geomAnd( TEMP0283 M2 )
TEMP0285 = geomButtOrOver( TEMP0281 TEMP0284 keep == 1 )
M2_5     = geomAndNot( TEMP0281 TEMP0285 )
errorLayer( M2_5 "M2.5 Minimum space between M2 lines with one or both metal line width&and length are greater than 10um is 0.60um @ The minimum space must be maintained between a metal line and a&small piece of metal(<10) that is connected to the wide metal" )

m206  	  = drc( M2 area < 0.20 ) 
errorLayer( m206 "M2.6:  Min. M2 area 0.20um^2" )

density( M2_e 0.30 )
errorLayer( coverage_error "M2.7: Min. M2 density 30%" )
/*
m208a    = geomAndNot( M2DUM geomGetRectangle( M2DUM length == 5.0  width == 2.0 ) )
m208b	  = drc( M2 M2DUM sep < 2.0 )
m208c	  = geomAnd( dev M2DUM ) 
m208	  = geomCat( m208a m208b m208c )
errorLayer( m208 "Dummy M2 spacing > 1.0um" )
*/

   if( !avSwitch( "top_m3" ) then

;------------------------
; -----  5.18 V2  -----
;------------------------

    v201  = geomContactCheck( V2 length == 0.26 width == 0.26 ignore )    
    errorLayer( v201 "V2.1: Min/max V2 size 0.26x0.26" )

    v202  = drc( V2 sep < 0.26 )  
    errorLayer( v202 "V2.2: Min. space between two V2 0.26um" )

    v203a = geomAndNot( V2 M2 )
    v203b = drc( M2 V2 enc < 0.01 )   
    v203  = geomCat(v203a v203b)    
    errorLayer( v203 "V2.3: Min. M2 enclosure for V2 0.01um" )

v2m2fast_venc    = drc(  M2 V2 enc < 0.06 oppositeB withIntersection edgeb )
v2m2t1     = geomGetAngledEdge( v2m2fast_venc keep ==0 mode1)
v2m2t2     = geomGetAdjacentEdge( v2m2fast_venc v2m2t1 )
v2m2t3     = geomGetAngledEdge( v2m2fast_venc keep ==45 )
v204       = geomAndNot( v2m2t2 v2m2t3 )
errorLayer( v204 "V2.4:Min. enclosure of M2 line end beyond V2 0.06" )

;------------------------
; -----  5.19 M3  ----- 
;------------------------

   wide_m3 = geomButtOrOver( M3 geomSize( M3 -5))
   wdm3_45 = geomGetAngledEdge( wide_m3  0 < keep < 90 )
   wdm3_90 = geomGetAngledEdge( wide_m3  0 < ignore < 90 )

   wdm3_exp_45 = geomSize( wdm3_45 -7.070 edges )
   wdm3_exp_90 = geomSize( geomStretch( wdm3_90 5 ) -5 edges )

   thin_m3_tmp = geomAndNot( wide_m3  geomOr( wdm3_exp_45 wdm3_exp_90 ) )
   thin_m3 = geomSnap( thin_m3_tmp 0.001 )  ;  end of shrink

;  begin grow
   tnm3_45 = geomGetAngledEdge( thin_m3  0 < keep < 90 )
   tnm3_90 = geomGetAngledEdge( thin_m3  0 < ignore < 90 )

   tnm3_exp_45_tmp = geomSize( tnm3_45 7.070 edges )
   tnm3_exp_45 = geomSnap( tnm3_exp_45_tmp 0.001 )
   tnm3_exp_90 = geomSize( geomStretch( tnm3_90 5 ) 5 edges )

   tnm3_exp = geomOr( tnm3_exp_45 tnm3_exp_90 )

   wdm3_pre = geomOr( tnm3_exp thin_m3 )
   wdm3_pre_fill = drc( wdm3_pre sep < 5 shielded opposite withSingularPoint withIntersection)
   m3over10 = geomOr( wdm3_pre wdm3_pre_fill ) 

;  end of grow

m301  	  = drc( M3  width < 0.28 withCornerTouch )
errorLayer( m301 "M3.1:  Min. width 0.28um" )

m302  	  = drc( M3 sepNotch < 0.28 ) 
errorLayer( m302 "M3.2:  Min. space 0.28um" )

m303a	  = geomAndNot( V2 M3 )
m303b  	  = drc( M3 V2 enc < 0.01 ) 
m303	  = geomCat( m303a m303b )
errorLayer( m303 "M3.3:  Min. enclosure of M3 over V2 0.01um" )

v2m3fast_venc    = drc(  M3 V2 enc < 0.06 oppositeB withIntersection edgeb )
v2m3t1     = geomGetAngledEdge( v2m3fast_venc keep ==0 mode1)
v2m3t2     = geomGetAdjacentEdge( v2m3fast_venc v2m3t1 )
v2m3t3     = geomGetAngledEdge( v2m3fast_venc keep ==45 )
m304       = geomAndNot( v2m3t2 v2m3t3 )
errorLayer( m304 "M3.4:Min. enclosure of M3 line end beyond V2 0.06" )

TEMP0380 = geomSizeAnd( wdm3_pre wide_m3 0.148 1.0 )
TEMP0381 = drc( TEMP0380 M3 0 < sep < 0.60 )
TEMP0382 = geomButtOrOver( M3 TEMP0380 )
TEMP0383 = geomSize( TEMP0381 .001 clipAcute )
TEMP0384 = geomAnd( TEMP0383 M3 )
TEMP0385 = geomButtOrOver( TEMP0381 TEMP0384 keep == 1 )
M3_5     = geomAndNot( TEMP0381 TEMP0385 )
errorLayer( M3_5 "M3.5 Minimum space between M3 lines with one or both metal line width&and length are greater than 10um is 0.60um @ The minimum space must be maintained between a metal line and a&small piece of metal(<10) that is connected to the wide metal" )

m306  	  = drc( M3 area < 0.20 ) 
errorLayer( m306 "M3.6:  Min. M3 area 0.20um^2" )

density( M3_e 0.30 )
errorLayer( coverage_error "M3.7: Min. M3 density 30%" )

/*
m308a     = geomAndNot( M3DUM geomGetRectangle( M3DUM length == 5.0  width == 2.0 ) )
m308b	  = drc( M3 M3DUM sep < 2.0 )
m308c	  = geomAnd( dev M3DUM ) 
m308	  = geomCat( m308a m308b m308c )
errorLayer( m308 "Dummy M3 spacing > 1.0um" )
*/

;--------------------------
; -----   5.20 M4   -----
;--------------------------

  if( !avSwitch( "top_m4" ) then
 
	;------------------------
	; -----  5.21 V3  ----- 
	;------------------------

	v301  = geomContactCheck( V3 length == 0.26 width == 0.26 ignore )    
	errorLayer( v301 "V3.1: Min/max V3 size 0.26x0.26" )

	v302  = drc( V3 sep < 0.26 )  
	errorLayer( v302 "V3.2: Min. space between two V3 0.26um" )

	v303a = geomAndNot( V3 M3 )
	v303b = drc( M3 V3 enc < 0.01 )   
	v303  = geomCat(v303a v303b)    
	errorLayer( v303 "V3.3: Min. M3 enclosure for V3 0.01um" )

v3m3fast_venc    = drc(  M3 V3 enc < 0.06 oppositeB withIntersection edgeb )
v3m3t1     = geomGetAngledEdge( v3m3fast_venc keep ==0 mode1)
v3m3t2     = geomGetAdjacentEdge( v3m3fast_venc v3m3t1 )
v3m3t3     = geomGetAngledEdge( v3m3fast_venc keep ==45 )
v304       = geomAndNot( v3m3t2 v3m3t3 )
errorLayer( v304 "V3.4:Min. enclosure of M3 line end beyond V3 0.06" )

m401  	  = drc( M4  width < 0.28 withCornerTouch )
errorLayer( m401 "M4.1:  Min. width 0.28um" )

m402  	  = drc( M4 sepNotch < 0.28 ) 
errorLayer( m402 "M4.2:  Min. space 0.28um" )

m403a	  = geomAndNot( V3 M4 )
m403b  	  = drc( M4 V3 enc < 0.01 ) 
m403	  = geomCat( m403a m403b )
errorLayer( m403 "M4.3:  Min. enclosure of M4 over V3 0.01um" )


v3m4fast_venc    = drc(  M4 V3 enc < 0.06 oppositeB withIntersection edgeb )
v3m4t1     = geomGetAngledEdge( v3m4fast_venc keep ==0 mode1)
v3m4t2     = geomGetAdjacentEdge( v3m4fast_venc v3m4t1 )
v3m4t3     = geomGetAngledEdge( v3m4fast_venc keep ==45 )
m404       = geomAndNot( v3m4t2 v3m4t3 )
errorLayer( m404 "M4.4:Min. enclosure of M4 line end beyond V3 0.06" )

   wide_m4 = geomButtOrOver( M4 geomSize( M4 -5))
   wdm4_45 = geomGetAngledEdge( wide_m4  0 < keep < 90 )
   wdm4_90 = geomGetAngledEdge( wide_m4  0 < ignore < 90 )


   wdm4_exp_45 = geomSize( wdm4_45 -7.070 edges )
   wdm4_exp_90 = geomSize( geomStretch( wdm4_90 5 ) -5 edges )

   thin_m4_tmp = geomAndNot( wide_m4  geomOr( wdm4_exp_45 wdm4_exp_90 ) )
   thin_m4 = geomSnap( thin_m4_tmp 0.001 )  ;  end of shrink

;  begin grow
   tnm4_45 = geomGetAngledEdge( thin_m4  0 < keep < 90 )
   tnm4_90 = geomGetAngledEdge( thin_m4  0 < ignore < 90 )


   tnm4_exp_45_tmp = geomSize( tnm4_45 7.070 edges )
   tnm4_exp_45 = geomSnap( tnm4_exp_45_tmp 0.001 )
   tnm4_exp_90 = geomSize( geomStretch( tnm4_90 5 ) 5 edges )

   tnm4_exp = geomOr( tnm4_exp_45 tnm4_exp_90 )

   wdm4_pre = geomOr( tnm4_exp thin_m4 )
   wdm4_pre_fill = drc( wdm4_pre sep< 5 shielded opposite withSingularPoint withIntersection)
   m4over10 = geomOr( wdm4_pre wdm4_pre_fill )  
   ;  end of grow

TEMP0480 = geomSizeAnd( wdm4_pre wide_m4 0.148 1.0 )
TEMP0481 = drc( TEMP0480 M4 0 < sep < 0.60 )
TEMP0482 = geomButtOrOver( M4 TEMP0480 )
TEMP0483 = geomSize( TEMP0481 .001 clipAcute )
TEMP0484 = geomAnd( TEMP0483 M4 )
TEMP0485 = geomButtOrOver( TEMP0481 TEMP0484 keep == 1 )
M4_5     = geomAndNot( TEMP0481 TEMP0485 )
errorLayer( M4_5 "M4.5 Minimum space between M4 lines with one or both metal line width&and length are greater than 10um is 0.60um @ The minimum space must be maintained between a metal line and a&small piece of metal(<10) that is connected to the wide meta" )

m406  	  = drc( M4 area < 0.20 ) 
errorLayer( m406 "M4.6:  Min. M4 area 0.20um^2" )

density( M4_e 0.30 )
errorLayer( coverage_error "M4.7: Min. M4 density 30%" )

/*
m408a     = geomAndNot( M4DUM geomGetRectangle( M4DUM length == 5.0  width == 2.0 ) )
m408b	  = drc( M4 M4DUM sep < 2.0 )
m408c	  = geomAnd( dev M4DUM ) 
m408	  = geomCat( m408a m408b m408c )
errorLayer( m408 "Dummy M4 spacing > 1.0um" )
*/

;--------------------------
; -----   5.22 M5   -----
;--------------------------

if( !avSwitch( "top_m5" ) then

;--------------------------
; -----   5.22 V4   -----
;--------------------------

	v401  = geomContactCheck( V4 length == 0.26 width == 0.26 ignore )    
	errorLayer( v401 "V4.1: Min/max V4 size 0.26x0.26" )

	v402  = drc( V4 sep < 0.26 )  
	errorLayer( v402 "V4.2: Min. space between two V4 0.26um" )

	v403a = geomAndNot( V4 M4 )
	v403b = drc( M4 V4 enc < 0.01 )   
	v403  = geomCat(v403a v403b)    
	errorLayer( v403 "V4.3: Min. M4 enclosure for V4 0.01um" )

v4m4fast_venc    = drc(  M4 V4 enc < 0.06 oppositeB withIntersection edgeb )
v4m4t1     = geomGetAngledEdge( v4m4fast_venc keep ==0 mode1)
v4m4t2     = geomGetAdjacentEdge( v4m4fast_venc v4m4t1 )
v4m4t3     = geomGetAngledEdge( v4m4fast_venc keep ==45 )
v404       = geomAndNot( v4m4t2 v4m4t3 )
errorLayer( v404 "V4.4:Min. enclosure of M4 line end beyond V4 0.06" )

m501  	  = drc( M5  width < 0.28 withCornerTouch )
errorLayer( m501 "M5.1:  Min. width 0.28um" )

m502  	  = drc( M5 sepNotch < 0.28 ) 
errorLayer( m502 "M5.2:  Min. space 0.28um" )

m503a	  = geomAndNot( V4 M5 )
m503b  	  = drc( M5 V4 enc < 0.01 ) 
m503	  = geomCat( m503a m503b )
errorLayer( m503 "M5.3:  Min. enclosure of M5 over V4 0.01um" )

v4m5fast_venc    = drc(  M5 V4 enc < 0.06 oppositeB withIntersection edgeb )
v4m5t1     = geomGetAngledEdge( v4m5fast_venc keep ==0 mode1)
v4m5t2     = geomGetAdjacentEdge( v4m5fast_venc v4m5t1 )
v4m5t3     = geomGetAngledEdge( v4m5fast_venc keep ==45 )
m504       = geomAndNot( v4m5t2 v4m5t3 )
errorLayer( m504 "M5.4:Min. enclosure of M5 line end beyond V4 0.06" )

   wide_m5 = geomButtOrOver( M5 geomSize( M5 -5))
   wdm5_45 = geomGetAngledEdge( wide_m5  0 < keep < 90 )
   wdm5_90 = geomGetAngledEdge( wide_m5  0 < ignore < 90 )

   wdm5_exp_45 = geomSize( wdm5_45 -7.070 edges )
   wdm5_exp_90 = geomSize( geomStretch( wdm5_90 5 ) -5 edges )

   thin_m5_tmp = geomAndNot( wide_m5  geomOr( wdm5_exp_45 wdm5_exp_90 ) )
   thin_m5 = geomSnap( thin_m5_tmp 0.001 )  ;  end of shrink

;  begin grow
   tnm5_45 = geomGetAngledEdge( thin_m5  0 < keep < 90 )
   tnm5_90 = geomGetAngledEdge( thin_m5  0 < ignore < 90 )

   tnm5_exp_45_tmp = geomSize( tnm5_45 7.070 edges )
   tnm5_exp_45 = geomSnap( tnm5_exp_45_tmp 0.001 )
   tnm5_exp_90 = geomSize( geomStretch( tnm5_90 5 ) 5 edges )

   tnm5_exp = geomOr( tnm5_exp_45 tnm5_exp_90 )

   wdm5_pre = geomOr( tnm5_exp thin_m5 )
   wdm5_pre_fill = drc( wdm5_pre sep< 5 shielded opposite withSingularPoint withIntersection)
   m5over10 = geomOr( wdm5_pre wdm5_pre_fill )  ;  end of grow


TEMP0580 = geomSizeAnd( wdm5_pre wide_m5 0.148 1.0 )
TEMP0581 = drc( TEMP0580 M5 0 < sep < 0.60 )
TEMP0582 = geomButtOrOver( M5 TEMP0580 )
TEMP0583 = geomSize( TEMP0581 .001 clipAcute )
TEMP0584 = geomAnd( TEMP0583 M5 )
TEMP0585 = geomButtOrOver( TEMP0581 TEMP0584 keep == 1 )
M5_5     = geomAndNot( TEMP0581 TEMP0585 )
errorLayer( M5_5 "M5.5 Minimum space between M5 lines with one or both metal line width&and length are greater than 10um is 0.60um&The minimum space must be maintained between a metal line and a&small piece of metal(<10) that is connected to the wide metal" )

m506  	  = drc( M5 area < 0.20 ) 
errorLayer( m506 "M5.6:  Min. M5 area 0.20um^2" )

density( M5_e 0.30 )
errorLayer( coverage_error "M5.7: Min. M5 density 30%" )

/*
m508a    = geomAndNot( M5DUM geomGetRectangle( M5DUM length == 5.0  width == 2.0 ) )
m508b	  = drc( M5 M5DUM sep < 2.0 )
m508c	  = geomAnd( dev M5DUM ) 
m508	  = geomCat( m508a m508b m508c )
errorLayer( m508 "Dummy M5 spacing > 1.0um" )
*/

    ); end if top_m5
  ); end if top_m4
 ); end if top_m3
); end if top_m2

;----------------------------------------
; -----   5.24 Top Metal  -  M6   -----
;----------------------------------------

if( !avSwitch( "top_m2") && !avSwitch( "top_m3") && !avSwitch( "top_m4" ) && !avSwitch( "top_m5" ) then
    Mtopi 	= geomCat(M6i) ;
    Mtop_e 	= geomCat(M6i M6DUMi) ;
    Mtop 	= geomCat(M6) ;
    Vtop 	= geomCat(V5) ;
    Mbot 	= geomCat(M5) ;
  ); end if

if( !avSwitch( "top_m2") && !avSwitch( "top_m3")&& !avSwitch( "top_m4") && avSwitch( "top_m5" ) then
    Mtopi 	= geomCat(M5i) ;
    Mtop_e 	= geomCat(M5i M5DUMi);
    Mtop 	= geomCat(M5);
    Vtop  	= geomCat(V4);
    Mbot 	= geomCat(M4) ;
  ); end if 

if( !avSwitch( "top_m2") && !avSwitch( "top_m3") && avSwitch(  "top_m4" ) && !avSwitch( "top_m5" ) then
    Mtopi 	= geomCat(M4i) ;
    Mtop_e 	= geomCat(M4i M4DUMi) ;
    Mtop 	= geomCat(M4);
    Vtop 	= geomCat(V3);
    Mbot 	= geomCat(M3) ;
  ); end if
if( !avSwitch( "top_m2") && avSwitch( "top_m3") && !avSwitch( "top_m4" ) && !avSwitch( "top_m5" ) then 

   Mtopi        = geomCat(M3i);
   Mtop_e 	= geomCat(M3i M3DUMi) ;
   Mtop         = geomCat(M3);
   Vtop         = geomCat(V2);
   Mbot         = geomCat(M2);
) ;end if
if( avSwitch( "top_m2") && !avSwitch( "top_m3") && !avSwitch( "top_m4" ) && !avSwitch( "top_m5" ) then
   Mtopi        = geomCat(M2i);  
   Mtop_e 	= geomCat(M2i M2DUMi) ;
   Mtop         = geomCat(M2);
   Vtop         = geomCat(V1);
   Mbot         = geomCat(M1);
); end if


;-------------------------------
; -----   5.25 Top Via   -----
;-------------------------------

vt01  = geomContactCheck( Vtop length == 0.36 width == 0.36 ignore )    
errorLayer( vt01 "Vtop.1: Min/max Vtop size 0.36x0.36" )

vt02  = drc( Vtop sep < 0.35 )  
errorLayer( vt02 "Vtop.2: Min. space between two Vtop 0.35um" )

	vt03a = geomAndNot( Vtop Mbot )
	vt03b = drc( Mbot Vtop enc < 0.01 )   
	vt03  = geomCat( vt03a vt03b)    
	errorLayer( vt03 "Vtop.3: Min. Mbot enclosure for Vn 0.01um" )

tvmbfast_venc    = drc(  Mbot Vtop enc < 0.06 oppositeB withIntersection edgeb )
tvmbt1     = geomGetAngledEdge( tvmbfast_venc keep ==0 mode1)
tvmbt2     = geomGetAdjacentEdge( tvmbfast_venc tvmbt1 )
tvmbt3     = geomGetAngledEdge( tvmbfast_venc keep ==45 )
Vtop04     = geomAndNot( tvmbt2 tvmbt3 )
errorLayer( Vtop04 "Vtop.4:Min. enclosure of Mbot line end beyond Vtop 0.06" )


	mt01  	  = drc( Mtop  width < 0.44 withCornerTouch )
	errorLayer( mt01 "Mtop.1:  Min. width 0.44um" )

	mt02  	  = drc( Mtop sepNotch < 0.46 ) 
	errorLayer( mt02 "Mtop.2:  Min. space 0.46um" )

	mt03a	  = geomAndNot( Vtop Mtop )
	mt03b  	  = drc( Mtop Vtop enc < 0.09 ) 
	mt03_a	  = geomCat( mt03a mt03b )
	errorLayer( mt03_a "Mtop.3a:  Min. enclosure of Mtop over Vtop 0.09um" )

        tvmtfast_venc    = drc(  Mtop Vtop enc < 0.09 oppositeB withIntersection edgeb )
        tvmtt1     = geomGetAngledEdge( tvmtfast_venc keep ==0 mode1)
        tvmtt2     = geomGetAdjacentEdge( tvmtfast_venc tvmbt1 )
        tvmtt3     = geomGetAngledEdge( tvmtfast_venc keep ==45 )
        tm03_b     = geomAndNot( tvmtt2 tvmtt3 )
        errorLayer( tm03_b "Mtop.3b: Min. enclosure of Mtop line end beyond Vtop 0.09" )


   wide_m6 = geomButtOrOver( Mtop geomSize( Mtop -5))
   wdm6_45 = geomGetAngledEdge( wide_m6  0 < keep < 90 )
   wdm6_90 = geomGetAngledEdge( wide_m6  0 < ignore < 90 )

   wdm6_exp_45 = geomSize( wdm6_45 -7.070 edges )
   wdm6_exp_90 = geomSize( geomStretch( wdm6_90 5 ) -5 edges )

   thin_m6_tmp = geomAndNot( wide_m6  geomOr( wdm6_exp_45 wdm6_exp_90 ) )
   thin_m6 = geomSnap( thin_m6_tmp 0.001 )  ;  end of shrink

;  begin grow
   tnm6_45 = geomGetAngledEdge( thin_m6  0 < keep < 90 )
   tnm6_90 = geomGetAngledEdge( thin_m6  0 < ignore < 90 )


   tnm6_exp_45_tmp = geomSize( tnm6_45 7.070 edges )
   tnm6_exp_45 = geomSnap( tnm6_exp_45_tmp 0.001 )
   tnm6_exp_90 = geomSize( geomStretch( tnm6_90 5 ) 5 edges )

   tnm6_exp = geomOr( tnm6_exp_45 tnm6_exp_90 )

   wdm6_pre = geomOr( tnm6_exp thin_m6 )
   wdm6_pre_fill = drc( wdm6_pre sep< 5 shielded opposite withSingularPoint withIntersection)
   m6over10 = geomOr( wdm6_pre wdm6_pre_fill )  ;  end of grow

TEMP0980 = geomSizeAnd( wdm6_pre wide_m6 0.148 1.0 )
TEMP0981 = drc( TEMP0980 Mtop 0 < sep < 0.60 )
TEMP0982 = geomButtOrOver( Mtop TEMP0980 )
TEMP0983 = geomSize( TEMP0981 .001 clipAcute )
TEMP0984 = geomAnd( TEMP0983 Mtop )
TEMP0985 = geomButtOrOver( TEMP0981 TEMP0984 keep == 1 )
MT_4     = geomAndNot( TEMP0981 TEMP0985 )
errorLayer( MT_4 "Mtop.4: Minimum space between top metal lines with one or both metal line width&and length are greater than 10um is 0.6um")

	mt05  	  = drc( Mtop_e area < 0.56 ) 
	errorLayer( mt05 "Mtop.5:  Min. Mtop area 0.56um^2" )

	density( Mtop_e 0.30 )
	errorLayer( coverage_error "Mtop.6: Min. Mtop density 30%" )
/*
	mt07a     = geomAndNot( M6DUM geomGetRectangle( M6DUM length == 5.0  width == 2.0 ) )
	mt07b	  = drc( Mtop M6DUM sep < 2.0 )
	mt07c	  = geomAnd( dev M6DUM ) 
	mt07ab	  = geomCat( mt07a mt07b )
	mt07	  = geomCat( mt07ab mt07c )
	errorLayer( mt07 "Mtop.7: Dummy Mtop spacing > 1.0um" )
*/


;-----------------
; ----- PI ------
;-----------------

pi01	= drc( PI 0 < sepNotch < 15 )
errorLayer( pi01 "PI.1: Min.space between two polymide open area is 15um")

pi02    = drc( bulk PI enc < 15 )
errorLayer( pi02 "PI.2: Min.space between polymide open area to chip edge is 15um")
;****************************************
;     6. Mixed Signal Design check
;****************************************

if( avSwitch( "Mixed_Signal" ) then
MTT	= geomCat( Mtop )
cv 	= geomAnd( Vtop MIM )
nv	= geomAndNot( Vtop cv )
geomConnect(
  via( cv MTT MIM ) 
  via( nv MTT Mbot )
)

;------------------------
; -----  6.1 DNW  -----
;------------------------

   hole_innw = geomHoles( NW )
   nw_hole = geomButtOnly( NW hole_innw )

   C2A0128  = geomGetEdge( DNW outside NW )
   TEMP0296 = geomAndNot( DNW NW )
   TEMP0297 = geomButtOrOver( DNW TEMP0296 )
   C2A0129  = geomGetEdge(geomAndNot( DNW TEMP0297 ))
   DNW_1    = geomCat( C2A0128 C2A0129 )
   errorLayer( DNW_1 "DNW.1 DNW must be surrounded by NW" )

   DNW_2 = geomAnd( RESNW DNW )
   errorLayer( DNW_2 "DNW.2 It's not allowed to use DNW layer as resistor" )

   
   nmosp = geomAnd( geomAnd( SP AA ) NW )
   npgate = geomAnd( nmosp GT )
   hpgate = geomAnd( npgate DG )
   TEMP0298 = geomButtOrOver( gate hpgate)
   TEMP0299 = geomButtOrOver( NW DNW )
   DNW_3    = geomAnd( TEMP0298 TEMP0299 )
   errorLayer( DNW_3 "DNW.3 3.3V PMOS is not allowed in the NW connected to DNW" )

   DNW_4 = drc( nw_hole DNW enc < 1.5 edge )
   errorLayer( DNW_4 "DNW.4 Minimum extension of NW beyond DNW is 1.5um" )

   DNW_5 = drc( DNW hole_innw enc < 2 )
   errorLayer( DNW_5 "DNW.5 Minimum overlap of NW onto DNW is 2.00um" )

   TEMP0300 = geomCat( geomGetEdge( NW inside DNW ) geomGetEdge( NW outside DNW ) )
   DNW_6    = drc( TEMP0300 DNW sep < 3.50 )
   errorLayer( DNW_6 "DNW.6 Minimum clearance from DNW to NW is 3.50" )

   DNW_7 = drc( DNW width < 3 withCornerTouch )
   errorLayer( DNW_7 "DNW.7 Minimum width of a DNW region is 3.00" )

   DNW_8 = drc( DNW sepNotch < 5.0 )
   errorLayer( DNW_8 "DNW.8 Minimum space between 2 DNW region is 5.00" )

   TEMP0301 = geomInside( geomAnd(AA SN)  geomButtOrOver( hole_innw DNW ) )
   C2A0130  =  drc( hole_innw TEMP0301 enc < 0.5 ) 
   errorLayer( C2A0130 "DNW.9 Minimum clearance from NW edge to a N+ AA region is outside a NW when DNW @ is implemented is 0.5" )

   TEMP0302 = geomButtOrOver( NW DNW )
   DNW_11   = geomAnd( TEMP0302 RESNW )
   errorLayer( DNW_11 "DNW.11 It's not allowed to use NW connect to DNW as resistor" )

;------------------------
; -----  6.2 PSUB  -----
;------------------------

   PB_1 = geomAnd( PSUB NW )
   errorLayer( PB_1 "PSUB.1: PSUB inside or cross over a N-Well is not allowed" )

   PB_2 = geomAnd( PSUB DNW )
   errorLayer( PB_2 "PSUB.2: PSUB inside or cross over a Deep N-Well is not allowed" )

   PB_3 = drc( PSUB width < 0.84 withCornerTouch )
   errorLayer( PB_3 "PSUB.3: Minimum dimension of PSUB region is 0.84" )

   PB_4 = drc( PSUB sepNotch < 0.84 )
   errorLayer( PB_4 "PSUB.4: Minimum space between 2 PSUB regions in same potential is 0.84" )

   pb_gate = geomAnd( geomAndNot( gate DG) PSUB )
   pb_gate_wid = geomGetEdge( pb_gate inside AA ) 
   PB_5 = drc( pb_gate_wid width < 0.5 )
   errorLayer( PB_5 "PSUB.5: Minimum Gate dimension of 1.8V native device is 0.5" )
   
   pb_hgate = geomAnd( geomAnd( gate DG) PSUB )
   pb_hgate_wid = geomGetEdge( pb_hgate inside AA )
   PB_5a = drc( pb_hgate_wid width < 1.2 )
   errorLayer( PB_5a "PSUB.5a: Minimum Gate dimension of 3.3V native device is 1.2" )

   TEMP0014 = geomButtOrOver( geomAnd(AA SN) PSUB )
   TEMP0015 = geomSize( TEMP0014 0.26 )
   TEMP0016 = geomButtOrOver( PSUB TEMP0014 )
   C2A0006  =  geomXor( TEMP0016 TEMP0015 )
   C2A0007  =  geomAvoiding( PSUB AA )
   PB_6     = geomCat( C2A0006 C2A0007 )
   errorLayer( PB_6 "PSUB.6: Minimum and Maximum PSUB extension beyond SN(N+) AA region is 0.26" )

   pb_aa = geomAnd( AA PSUB )
   nomi_aa = geomAndNot( AA pb_aa )
   PB_7 = drc( PSUB nomi_aa sep < 0.52 )
   errorLayer( PB_7 "PSUB.7: Minimum clearance from PSUB region to a nominal AA region is 0.52" )

   PB_8 = drc( PSUB NW sep < 1.62 withSingularPoint withIntersection)
   errorLayer( PB_8 "PSUB.8: Minimum clearance from PSUB region to N-Well edge is 1.62" )

   
   PB_9 = geomButtOrOver( gt_w_bend PSUB ) 
   pb9  = geomAnd( geomInside( GT AA ) PSUB)
   errorLayer( geomCat(PB_9 pb9) "PSUB.9: Bent Gate Poly is not allowed to put in PSUB region" )

   PB_10 = geomAnd( SP PSUB )
   errorLayer( PB_10 "PSUB.10: P+ region is not allowed to put in PSUB region" )

   mosn = geomAndNot( geomAnd(AA SN ) NW)
   PB_11 = geomButtOrOver( PSUB mosn keep > 1 )
   errorLayer( PB_11 "PSUB.11: Only one AA region is allowed to put in PSUB region" )


;-------------------------
; -----  6.3 MVN   -----
;-------------------------
   C2A0132 =  geomButtOrOver( MVN NW )
   C2A0133 =  geomButtOrOver( MVN PSUB )
   MVN_1   = geomCat( C2A0132 C2A0133 )
   errorLayer( MVN_1 "MVN.1 MVN inside or cross over Nwell or PSUB is not allowed" )

   MVN_2 = geomButtOrOver( MVN DNW )
   errorLayer( MVN_2 "MVN.2 MVN inside or cross over Deep NWell is not allowed" )

   mvn03     = geomButtOrOver( gt11 MVN )
   errorLayer( mvn03 "MVN.3: A bent gate is not allowed put in MVN" )

   MVN_4 = drc( MVN width < 0.72 withCornerTouch )
   errorLayer( MVN_4 "MVN.4 Minimum dimension of MVN region is 0.72" )

   lvmvngate = geomAnd( lvgate MVN )
   lmgtEdge  = drc( AA lvmvngate  enc == 0 edgeb opposite  )
   mvn05     = geomGetLength( lmgtEdge keep < 0.30 )
   errorLayer( mvn05 "MVN.5: Min. dimension of gate area of 1.8V Medium NMOS device 0.30um" )

   hvmvngate = geomAnd( hvgt MVN )
   hmgtEdge  = drc( AA hvmvngate  enc == 0 edgeb opposite )
   mvn05a    = geomGetLength( hmgtEdge keep < 0.60 )
   errorLayer( mvn05a "MVN.5a: Min. dimension of gate area of 3.3V Medium NMOS device 0.60um" )

   MVN_6 = drc( MVN geomAnd(AA SN) sep < 0.70 )
   errorLayer( MVN_6 "MVN.6 Minimum clearance from a MVN region to a SN(N+) AA region is 0.70" )


   MVN_7 = drc( MVN NW sep < 0.42 )
   errorLayer( MVN_7 "MVN.7 Minimum clearance from a MVN region to a Nwell edge is 0.42" )

   MVN_8 = drc( MVN geomAnd(AA SN) enc < 0.25 )
   errorLayer( MVN_8 "MVN.8 Minimum extension from a MVN region beyond SN(N+) AA region is 0.25" )

   MVN_9 = drc( MVN  0 < sepNotch < 0.42 )
   errorLayer( MVN_9 "MVN.9 Minimum space between two MVN regions. Merge if less than 0.42" )

   MVN_10 = geomAnd( SP MVN )
   errorLayer( MVN_10 "MVN.10 A SP(P+) region is not allowed in a MVN region" )


;--------------------------
; -----   6.4 MVP   -----
;--------------------------


bulk = geomBkgnd()
pw = geomAndNot( bulk NW )

   C2A0134 = geomButtOrOver( MVP pw ) 
   C2A0135 = geomButtOrOver( MVP PSUB ) 
   MVP_1   = geomCat( C2A0134 C2A0135 )
   errorLayer( MVP_1 "MVP.1 MVP inside or cros over Pwell or PSUB is not allowed" )

   MVP_2 = geomButtOrOver( MVP DNW )
   errorLayer( MVP_2 "MVP.2 MVP inside or cross over Deep NWell is not allowed" )

   mvp03     = geomButtOrOver( gt11 MVP )
   errorLayer( mvp03 "MVP.3: A bent gate is not allowed put in MVP" )

   MVP_4 = drc( MVP width < 0.72 withCornerTouch )
   errorLayer( MVP_4 "MVP.4 Minimum dimension of MVP region is 0.72" )

   lvmvpgate = geomAnd( lvgate MVP )
   lmgtEdge  = drc( AA lvmvpgate  enc == 0 edgeb opposite )
   mvp05     = geomGetLength( lmgtEdge keep < 0.25 )
   errorLayer( mvp05 "MVP.5: Min. dimension of gate area of 1.8V Medium PMOS device 0.25um" )

   MVP_6 = drc( MVP geomAnd(AA SP) sep < 0.70 )
   errorLayer( MVP_6 "MVP.6 Minimum clearance from a MVP region to a SP(P+) AA region is 0.70" )

   MVP_7 = drc( NW MVP enc < 0.42 )
   errorLayer( MVP_7 "MVP.7 Minimum extension from a NWell region beyond MVP region is 0.42" )

   MVP_8 = drc( MVP geomAnd(AA SP) enc < 0.25 )
   errorLayer( MVP_8 "MVP.8 Minimum extension from a MVP region beyond SP(P+) AA region is 0.25" )

   MVP_9 = drc( MVP  0 < sepNotch < 0.42 )
   errorLayer( MVP_9 "MVP.9 Minimum space between two MVP regions. Merge if less than 0.42" )

   MVP_10 = geomAnd( SN MVP )
   errorLayer( MVP_10 "MVP.10 A SN(N+) region is not allowed in a MVP region" )

;------------------------
; -----  6.5 HRP  -----
;------------------------

   HRP_2 = drc( HRP gt_res_hrp enc < 0.26 )
   errorLayer( HRP_2 "HRP.2: Minimum extension from HRP region beyond a poly resistor region is 0.26" )

   TEMP0312 = geomButtOrOver( GT gate )
   HRP_3_4  = drc( HRP TEMP0312 sep < 0.32 )
   errorLayer( HRP_3_4 "HRP.3& HRP.4: Minimum clearance from HRP region to Polygate of NMOS/PMOS is 0.32" )

   TEMP0313 = geomButtOrOver( SP HRP )
   TEMP0314 = geomButtOrOver( SAB HRP )
   C2A0136  = geomGetEdge( drc( TEMP0313 TEMP0314 ovlp < 0.30 ) )

   TEMP0315 = geomSize( TEMP0313 -0.30 )
   C2A0137  = geomGetEdge( geomAnd( TEMP0315 TEMP0314 ) )
   HRP_5    = geomCat( C2A0136 C2A0137 )
   errorLayer( HRP_5 "HRP.5: Minimum and maximum P+ implant for pickup oerlap with SAB is 0.30" )

   HRP_6 = drc( SAB gt_res_hrp enc < 0.22 )
   errorLayer( HRP_6 "HRP.6: Minimum extension from SAB region beyond a poly resistor region is 0.22" )

   HRP7a  = geomGetEdge( geomAnd( GT HRP ) inside HRPDMY )
   HRP_7  = drc( HRP7a width < 2.00 withCornerTouch )
   errorLayer( HRP_7 "HRP.7: Minimum width of Poly region for high resistance poly resistor is 2.00" )
  
   TEMP0316 = geomButtOrOver( SAB HRP )
   HRP_8    = geomAvoiding( TEMP0316 HRPDMY )
   errorLayer( HRP_8 "HRP.8: Dummy layer HRPDMY is needed for DRC for high resistance Poly region" )

   C2A0138 = geomGetEdge( geomAnd( hr_gt SP ) )
   C2A0139 = geomGetEdge( geomAnd( hr_gt SN ) )
   HRP_10  = geomCat( C2A0138 C2A0139 )
   errorLayer( HRP_10 "HRP.10: it is not allowed to receive S/D-SN,and all LDD implant in the HRP region" )
 
;--------------------------
; -----   6.6 MiM   -----
;--------------------------

CAP_MIM   = geomEnclose( MIM Vtop )
DMY_MIM   = geomAndNot( MIM CAP_MIM )
Mbot_CAPMIM = geomButtOrOver( geomSize( Mbot -2 downUp ) CAP_MIM )
Mbot_DMYMIM = geomButtOrOver( geomSize( Mbot -2 downUp ) DMY_MIM )
;Mbot_CAPMIM = geomSize( geomButtOrOver( Mbot CAP_MIM) -2 downUp)

mim01 	  = drc( CAP_MIM width < 4.0 withCornerTouch ) 
errorLayer( mim01 "MiM.1: Min. width of MiM as top plate 4.00um" );

mim02 	  = drc( CAP_MIM 0 < sepNotch < 1.20 ) 
errorLayer( mim02 "MiM.2: Min. space between two MiM as top plate 1.20um" );

mim03 	  = drc( MIM Vtop enc < 0.24 ) 
errorLayer( mim03 "MiM.3: Min. extension of MiM beyond Via which connect to this MiM 0.24um" );

mim04 	  = drc( Mbot_CAPMIM CAP_MIM enc < 0.4 )
errorLayer( mim04 "MiM.4: Min. extension of bottom plate(Mn) on MiM 0.40um" );

mim06 	  = geomAnd( CAP_MIM dev ) 
errorLayer( mim06 "MiM.6: Both active & passive devices under MiM are not allowed" );

mim07aa	  = drc( CAP_MIM width <= 30.0 withCornerTouch ) 
mim07a	  = geomAndNot( CAP_MIM mim07aa ) 
mim07b    = drc( CAP_MIM area > 900 )
mim07 	  = geomCat( mim07a mim07b )
errorLayer( mim07 "MiM.7: Max. dimension of MiM as capacitor top metal 30.0um
                   If capacitor larger than 30*30, please use combination of smaller capacitor" );

mbotmim   = geomOverlap( Mbot CAP_MIM )
mim08a 	  = drc( mbotmim width <= 35.0 withCornerTouch ) 
mim08 	  = geomAndNot( mbotmim mim08a ) 
errorLayer( mim08 "MiM.8: Max. dimension of bottom metal(Mn) in capacitor 35.0um 
                   If capacitor larger than 35*35, please use combination of smaller capacitor" );

density( MIMi 0.03 )
errorLayer( coverage_error "MiM.9: Min. density of MiM pattern. 3%" );

if( !avSwitch( "top_m2") && !avSwitch( "top_m3") && !avSwitch( "top_m4" ) && !avSwitch( "top_m5" ) then
    mim_inside_m5= geomInside( MIM Mbot )
    mim05        = geomAndNot( MIM mim_inside_m5 )
    errorLayer( mim05 "MiM.5: MiM region cross bottom plate(M5) Metal region is not allowed") 

    viamet_m6    = geomCat( V1 V2 V3 V4 M1 M2 M3 M4 )
    mim10 	 = geomAnd(viamet_m6 CAP_MIM ) 
    errorLayer( mim10 "MiM.10: No via and metal layers under MiM are allowed" );
    

    below_metal  = geomCat( M1 M2 M3 M4 )
    mim18a       = drc( Mbot_CAPMIM below_metal sep < 2.0 )
    mim18b       = geomAnd( Mbot_CAPMIM below_metal )
    mim18        = geomCat( mim18a mim18b )
    errorLayer( mim18 "MiM.18: Min. space of MIM capacitor bottom metal(Mn) with Via to below all metal layers is 2.0um") 

); end top_m6

if( !avSwitch( "top_m2") && !avSwitch( "top_m3")&& !avSwitch( "top_m4") && avSwitch( "top_m5" ) then
    mim_inside_m4= geomInside( MIM Mbot )
    mim05        = geomAndNot( MIM mim_inside_m4 )
    errorLayer( mim05 "MiM.5: MiM region cross bottom plate(M4) Metal region is not allowed")

    viamet_m5    = geomCat( V1 V2 V3 M1 M2 M3 )
    mim10 	 = geomAnd( viamet_m5 CAP_MIM ) 
    errorLayer( mim10 "MiM.10: No via and metal layers under MiM are allowed" );

    below_metal  = geomCat( M1 M2 M3 )
    mim18a       = drc( Mbot_CAPMIM below_metal sep < 2.0 )
    mim18b       = geomAnd( Mbot_CAPMIM below_metal )
    mim18        = geomCat( mim18a mim18b )
    errorLayer( mim18 "MiM.18: Min. space of MIM capacitor bottom metal(Mn) with Via to below all metal layers is 2.0um") 

); end top_m5

if( !avSwitch( "top_m2") && !avSwitch( "top_m3") && avSwitch(  "top_m4" ) && !avSwitch( "top_m5" ) then
    mim_inside_m3= geomInside( MIM Mbot )
    mim05        = geomAndNot( MIM mim_inside_m3 )
    errorLayer( mim05 "MiM.5: MiM region cross bottom plate(M3) Metal region is not allowed")

    viamet_m4    = geomCat( V1 V2 M1 M2 )
    mim10 	 = geomAnd( viamet_m4 CAP_MIM ) 
    errorLayer( mim10 "MiM.10: No via and metal layers under MiM are allowed" );

    below_metal  = geomCat( M1 M2 )
    mim18a       = drc( Mbot_CAPMIM below_metal sep < 2.0 )
    mim18b       = geomAnd( Mbot_CAPMIM below_metal )
    mim18        = geomCat( mim18a mim18b )
    errorLayer( mim18 "MiM.18: Min. space of MIM capacitor bottom metal(Mn) with Via to below all metal layers is 2.0um")

); end top_m4

if( !avSwitch( "top_m2") && avSwitch( "top_m3") && !avSwitch(  "top_m4" ) && !avSwitch( "top_m5" ) then
    mim_inside_m2= geomInside( MIM Mbot )
    mim05        = geomAndNot( MIM mim_inside_m2 )
    errorLayer( mim05 "MiM.5: MiM region cross bottom plate(M3) Metal region is not allowed")

    viamet_m3    = geomCat( V1  M1 )
    mim10        = geomAnd( viamet_m3 CAP_MIM )
    errorLayer( mim10 "MiM.10: No via and metal layers under MiM are allowed" );

    below_metal  = geomCat( M1 )
    mim18a       = drc( Mbot_CAPMIM below_metal sep < 2.0 )
    mim18b       = geomAnd( Mbot_CAPMIM below_metal )
    mim18        = geomCat( mim18a mim18b )
    errorLayer( mim18 "MiM.18: Min. space of MIM capacitor bottom metal(Mn) with Via to below all metal layers is 2.0um")

); end top_m3

Vtop_MIM   = geomAnd( Vtop CAP_MIM)
Vtop_CAPM  = geomAndNot( geomAnd( Vtop Mbot_CAPMIM) Vtop_MIM)

mim11 	  = drc( Mbot_CAPMIM Vtop_CAPM enc < 0.12 ) 
errorLayer( mim11 "MiM.11: Min. extension of capacitor bottom metal beyond Via connect to Mn 0.12um" );

mim12     = drc( CAP_MIM Vtop_CAPM sep < 0.4 )
errorLayer( mim12 "MiM.12: Min. clearance of top Via to MiM 0.40um" );

cv        = geomAnd( Vtop MIM )
mim13a    = drc( Vtop_MIM sep < 2.0 )
mim13     = geomInside( mim13a MIM )
errorLayer( mim13 "MiM.13: Min. space between two Via on MiM 2.0um" );

test1 = geomSize( Mbot_CAPMIM -2 downUp)
test2 = geomAndNot( test1 CAP_MIM)
test3 = geomAnd( Vtop_CAPM  test2)
mim14a = drc( test3 sep < 4 )
mim14 = geomInside( mim14a mbotmim )
errorLayer( mim14 "MiM.14: Min. space between two Via on bottom metal(Mn) 4.00um" );

dmim 	  = geomAndNot( MIM CAP_MIM )
mim15 	  = drc( dmim width < 0.4 withCornerTouch ) 
errorLayer( mim15 "MiM.15: Min. width of dummy MiM 0.40um" );

mim16 	  = drc( dmim CAP_MIM sep < 0.80 ) 
errorLayer( mim16 "MiM.16: Min. space of dummy MiM to MiM 0.80um" );

mim17 	  = drc( Mbot_CAPMIM Mbot_DMYMIM sep < 0.80 )
errorLayer( mim17 "MiM.17: Min. space of MiM capacitor bottom Mn to dummy Mn 0.80um" );

); end if Mixed Signal

;============================
;    Conventional Check
;============================

convention_FLT_NW = geomOutside( NW ntie )
errorLayer( convention_FLT_NW "convention_FLT_NW:NW is floating" )

bpmo   = geomAnd( geomAnd( AA SP ) GT )
convention_BPMO = geomAnd( PWa bpmo )
errorLayer( convention_BPMO "convention_BPMO:PMOS in PW" )

imp_x  = geomOutside( AA RESNW )
imp_y  = geomAndNot( geomAndNot( imp_x SN ) SP )
errorLayer( imp_y "convention_BAP_IMP: AA area without any implant ")

bulk = geomBkgnd()
TEMP0020 = geomGetCorner( ntie manhattanOnly  )
TEMP0021 = geomAndNot( ntie TEMP0020 )
TEMP0022 = geomSizeAnd( TEMP0021 NW 1.35 30 )
TEMP0023 = geomAnd( pmos NW )
LAT_3a  = geomGetEdge( TEMP0023 outside TEMP0022 )
errorLayer( LAT_3a "Latchup.Guidance.3_a: Maximum space from any point within Source/Drain region to the nearest pickup AA region inside the same well for I/O and internal circuits" )

pw = geomAndNot( bulk NW )
TEMP0024 = geomGetCorner( ptie manhattanOnly  )
TEMP0025 = geomAndNot( ptie TEMP0024 )
TEMP0026 = geomSizeAnd( TEMP0025 pw 1.35 30 )
TEMP0027 = geomAnd( nmos pw )
LAT_3b  = geomGetEdge( TEMP0027 outside TEMP0026 )
errorLayer( LAT_3b "Latchup.Guidance.3_b: Maximum space from any point within Source/Drain region to the nearest pickup AA region inside the same well for I/O and internal circuits" )



); drcExtractRules comlpete

